<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>K3s on 乱世浮生</title><link>https://atbug.com/tags/k3s/</link><description>Recent content in K3s on 乱世浮生</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><lastBuildDate>Sun, 16 Mar 2025 23:06:30 +0800</lastBuildDate><atom:link href="https://atbug.com/tags/k3s/index.xml" rel="self" type="application/rss+xml"/><item><title>Azure 云上 10 分钟全自动部署 K3s 集群实战</title><link>https://atbug.com/azure-k3s-cluster-automation-in-10-minutes/</link><pubDate>Sun, 16 Mar 2025 23:06:30 +0800</pubDate><guid>https://atbug.com/azure-k3s-cluster-automation-in-10-minutes/</guid><description>背景 在云计算与容器化技术飞速发展的今天，快速搭建可扩展的 Kubernetes 集群成为开发者的必备技能。尤其是在开发测试环境中，能够快速创建、销毁集群是提升工作效率的关键。
K3s 作为轻量级 Kubernetes 发行版，非常适合在云上快速搭建测试、开发或边缘计算集群。结合 IaC（基础设施即代码）工具 Terraform 和自动化脚本项目 k3s-cluster-automation，可以极大提升集群部署效率，降低人为操作风险。
本文将介绍如何通过 Terraform 与 k3s-cluster-automation 脚本，在 Azure 云上实现从虚拟机创建到 K3s 集群部署的全自动化流程，整个过程无需手动干预，大幅提升开发测试效率。
为什么选择 Azure + K3s + Terraform？ Azure：提供稳定的云计算资源，适合快速部署测试环境（还有另外一个原因，作为微软 MVP，可以免费使用 Azure 资源） K3s：轻量级 Kubernetes 发行版，资源占用少（仅需 512MB 内存），适合边缘计算与测试集群，是我喜欢的 Kubernetes 发行版之一 Terraform：基础设施即代码（IAC）工具，通过代码描述资源状态，支持版本控制与批量部署 前置条件 Azure 账户（需有资源创建权限） 本地环境：安装 Terraform CLI、Azure CLI K3s 部署工具：k3sup CLI（用于远程部署 K3s） 一、通过 Terraform 创建 Azure 虚拟机 1.</description></item><item><title>曲线救国：通过 OrbStack 在 Apple Silicon 平台搭建 K3s x86 集群</title><link>https://atbug.com/setup-k3s-x86-cluster-on-apple-silicon-with-orbstack/</link><pubDate>Fri, 26 Apr 2024 17:34:42 +0800</pubDate><guid>https://atbug.com/setup-k3s-x86-cluster-on-apple-silicon-with-orbstack/</guid><description>请原谅这个标题有点拗口。
如果你对 Apple Silicon、OrbStack、x86 架构或 K3s 集群中的任何一个概念不感兴趣，那么这篇文章可能不适合你。
背景 在我的工作流中，我依赖于 M1 MacBook Pro 和多个高效工具的结合。我使用 OrbStack 创建虚拟机，这个平台通过 Rosetta 进行二进制转换以实现虚拟化，不仅虚拟化速度快，还有其他众多优点（更多详情请见 OrbStack 优势）。同时，我偏爱使用 K3s 集群因为其轻量级特性，搭配先前介绍的 k3sup 工具，能够迅速搭建新的集群。
虽然这一系列工具的组合主打速度快和轻便，但当它们结合使用时，也会出现一些技术挑战。例如，在 OrbStack 创建的 x86 虚拟机上安装 K3s 时，我遇到了一个常见的问题，这个问题在社区中已经有了广泛的讨论并看似无解，具体可参见这个 GitHub 讨论。
Failed to create pod sandbox: rpc error: code = Unknown desc = failed to generate sanbdox container spec options: failed to generate seccomp spec opts: seccomp is not supported 在我的虚拟环境中，尽管使用 Docker 运行容器没有遇到问题，但在安装 K3s 时却遭遇挑战。值得注意的是，无论是 Docker 还是 K3s，它们都依赖于 Containerd 作为容器运行时。这一点让我怀疑问题可能出在 K3s 内置的 Containerd 配置上。</description></item><item><title>使用 k3sup 一分钟快速搭建 K3s 集群</title><link>https://atbug.com/setup-k3s-cluster-with-k3sup-in-one-minute/</link><pubDate>Fri, 27 Oct 2023 04:55:13 +0800</pubDate><guid>https://atbug.com/setup-k3s-cluster-with-k3sup-in-one-minute/</guid><description>更新于 2025 年 3 月 1 日：完整脚本已添加更多功能，并提交至 GitHub 仓库 k3s-cluster-automation。
​单命令集群部署：通过 SSH 一键部署含 1 个主节点 + N 个工作节点的 K3s 集群。 ​组件可定制化：可禁用非必要服务（如 Traefik 入口控制器、metrics-server 指标服务器等），实现轻量化部署。 ​多节点支持：通过环境变量 HOSTS 灵活配置节点列表。 ​版本控制：支持指定 K3s 版本（默认版本：v1.28.13+k3s1）。 ​Docker 集成：可选 Docker 运行时替代 containerd。 ​自动清理：一键移除集群所有组件，不留残留。 背景 在平时的工作中，为了方便在纯净的环境中进行测试，我经常需要在本地或者公有云环境中频繁地搭建和销毁集群。有时是在 我的 HomeLab 环境中，虽然 CPU 不强但胜在内存够大；后来有了微软 MVP 赠送的 Azure 额度之后，我也会经常在 Azure 虚拟机 中搭建，因为没有拉取镜像的网络问题。</description></item></channel></rss>