<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <link href="https://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.57.2" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Kubernetes学习 — Macos安装Kubernetes &middot; 乱世浮生</title>
  <meta name="description" content="" />

  
  <link type="text/css" rel="stylesheet" href="https://atbug.com/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="https://atbug.com/css/poole.css">
  <link type="text/css" rel="stylesheet" href="https://atbug.com/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="https://atbug.com/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="../apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="../favicon.png">

  
  
</head>

  <body class=" ">
  <aside class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="https://atbug.com/"><h1>乱世浮生</h1></a>
      <p class="lead">
       知我者谓我何忧 不知我者谓我何求. 
      </p>
    </div>

    <nav>
      <ul class="sidebar-nav">
        <li><a href="https://atbug.com/">Home</a> </li>
        <li><a href="../post/"> Archives </a></li><li><a href="../tags/"> Tags </a></li><li><a href="../categories/"> Categories </a></li><li><a href="../about/"> About </a></li>
      </ul>
    </nav>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</aside>

    <main class="content container">
    <div class="post">
  <h1>Kubernetes学习 — Macos安装Kubernetes</h1>
  <time datetime=2017-08-17T09:44:17Z class="post-date">Thu, Aug 17, 2017</time>
  

<h1 id="kubernetes">Kubernetes</h1>

<h2 id="安装">安装</h2>

<h2 id="macos">macos</h2>

<h3 id="检查环境">检查环境</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">sysctl -a <span class="p">|</span> grep machdep.cpu.features <span class="p">|</span> grep VMX</code></pre></td></tr></table>
</div>
</div>
<h3 id="安装virtualbox">安装VirtualBox</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">http://download.virtualbox.org/virtualbox/5.1.26/Oracle_VM_VirtualBox_Extension_Pack-5.1.26-117224.vbox-extpack</pre></td></tr></table>
</div>
</div>
<h3 id="安装minikube">安装minikube</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -Lo minikube https://storage.googleapis.com/minikube/releases/v0.21.0/minikube-darwin-amd64 <span class="o">&amp;&amp;</span> chmod +x minikube <span class="o">&amp;&amp;</span> sudo mv minikube /usr/local/bin/</code></pre></td></tr></table>
</div>
</div>
<h3 id="创建集群">创建集群</h3>

<p>默认使用virtualbox。</p>

<p>主机的ip是<code>192.168.31.186</code>， <code>1087</code>是proxy的端口。需要将ss的http代理监听地址从<code>127.0.0.1</code>改为主机的ip。</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="c1">#启动</span>
minikube start
<span class="c1">#使用私有库</span>
minikube start --insecure-registry<span class="o">=</span><span class="s2">&#34;192.168.31.34&#34;</span>
<span class="c1">#使用proxy，用于获取镜像</span>
minikube start --docker-env <span class="nv">HTTP_PROXY</span><span class="o">=</span><span class="s2">&#34;192.168.31.186:1087&#34;</span> --docker-env <span class="nv">HTTPS_PROXY</span><span class="o">=</span><span class="s2">&#34;192.168.31.186:1087&#34;</span> --docker-env <span class="nv">NO_PROXY</span><span class="o">=</span><span class="m">192</span>.168.99.0/24</code></pre></td></tr></table>
</div>
</div>
<h3 id="安装kubectl">安装kubectl</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">curl -Lo kubectl http://storage.googleapis.com/kubernetes-release/release/v1.7.3/bin/darwin/amd64/kubectl <span class="o">&amp;&amp;</span> chmod +x kubectl <span class="o">&amp;&amp;</span> sudo mv kubectl /usr/local/bin/</code></pre></td></tr></table>
</div>
</div>
<h3 id="oh-my-zsh-tab-completion">oh-my-zsh tab completion</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">vi ~/.zshrc</code></pre></td></tr></table>
</div>
</div>
<blockquote>
<p>添加到plugin部分<br />
plugins=(git zsh-completions kubectl)</p>
</blockquote>

<h2 id="使用">使用</h2>

<h3 id="minikube">minikube</h3>

<h4 id="检查版本">检查版本</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">minikube version
<span class="c1">#minikube version: v0.21.0</span>

kubectl version
<span class="c1">#Client Version: version.Info{Major:&#34;1&#34;, Minor:&#34;3&#34;, GitVersion:&#34;v1.3.0&#34;, GitCommit:&#34;283137936a498aed572ee22af6774b6fb6e9fd94&#34;, GitTreeState:&#34;clean&#34;, BuildDate:&#34;2016-07-01T19:26:38Z&#34;, GoVersion:&#34;go1.6.2&#34;, Compiler:&#34;gc&#34;, Platform:&#34;darwin/amd64&#34;}</span>
<span class="c1">#Server Version: version.Info{Major:&#34;1&#34;, Minor:&#34;7&#34;, GitVersion:&#34;v1.7.0&#34;, GitCommit:&#34;d3ada0119e776222f11ec7945e6d860061339aad&#34;, GitTreeState:&#34;clean&#34;, BuildDate:&#34;2017-07-26T00:12:31Z&#34;, GoVersion:&#34;go1.8.3&#34;, Compiler:&#34;gc&#34;, Platform:&#34;linux/amd64&#34;}</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="获取集群地址">获取集群地址</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">minikube ip
<span class="m">192</span>.168.99.100</code></pre></td></tr></table>
</div>
</div>
<h2 id="获取服务列表">获取服务列表</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">minikube service list</code></pre></td></tr></table>
</div>
</div>
<h2 id="打开dashboard">打开dashboard</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">minikube dashboard</code></pre></td></tr></table>
</div>
</div>
<h2 id="kubectl">kubectl</h2>

<h4 id="部署dashboard-ui">部署Dashboard UI</h4>

<p>默认minikube会自动部署dashboard</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl create -f https://rawgit.com/kubernetes/dashboard/master/src/deploy/kubernetes-dashboard.yaml</code></pre></td></tr></table>
</div>
</div>
<h4 id="启动proxy">启动proxy</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl proxy
<span class="c1">#Starting to serve on 127.0.0.1:8001</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="获取pod信息">获取pod信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl get pods --namespace kube-system

NAME                                    READY     STATUS              RESTARTS   AGE
kube-addon-manager-minikube             <span class="m">0</span>/1       Running   <span class="m">0</span>          1h
kubernetes-dashboard-3313488171-90s64   <span class="m">0</span>/1       Running   <span class="m">0</span>          20m</code></pre></td></tr></table>
</div>
</div>
<p>如果STATUS一直处于<strong>ContainerCreating</strong>状态，应该是pull image失败。默认是去gcr.io拉镜像，被墙了。需要在启动minikube的时候设置docker使用的代理。</p>

<h4 id="获取pod详细信息">获取pod详细信息</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">kubectl describe pod kubernetes-dashboard-3313488171-90s64 --namespace kube-system</pre></td></tr></table>
</div>
</div>
<h4 id="查看log">查看log</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-shell" data-lang="shell">kubectl logs -f kubernetes-dashboard-3313488171-90s64</code></pre></td></tr></table>
</div>
</div>
</div>

<h2>Comments</h2>
<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "addozhang" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </main>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-47966140-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

  </body>
</html>
