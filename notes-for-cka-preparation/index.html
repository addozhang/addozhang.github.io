<!doctype html><html lang=zh-cn data-figures class=page data-mode=dim><head><title>Kubernetes CKA 证书备考笔记 | 乱世浮生</title><meta charset=utf-8><meta name=generator content="Hugo 0.81.0"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta http-equiv=x-ua-compatible content="IE=edge"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47966140-1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','UA-47966140-1')</script><script>var _hmt=_hmt||[];(function(){var a=document.createElement("script"),b;a.src="https://hm.baidu.com/hm.js?f0888d005656102d93e6929886f2dcd3",b=document.getElementsByTagName("script")[0],b.parentNode.insertBefore(a,b)})()</script><meta property="og:locale" content="zh-cn"><meta property="og:type" content="article"><meta name=description content="Kubernetes 使用有好几年了，但在今年 5 月才完成 CKA 的考试。虽说用了几年，还是提前刷了部分题熟悉下。 绝大部分题都是有在 minikube 的环境上操作过，只有部分比如升级集群受限于环境问题没有实地操作。 写在最前 保存常用文档进书签，如果有 Alfred 启用浏览器书签 workflow。 …"><meta name=twitter:card content="summary"><meta name=twitter:creator content><meta name=twitter:title content="Kubernetes CKA 证书备考笔记"><meta property="og:url" content="https://atbug.com/notes-for-cka-preparation/"><meta property="og:title" content="Kubernetes CKA 证书备考笔记"><meta property="og:description" content="Kubernetes 使用有好几年了，但在今年 5 月才完成 CKA 的考试。虽说用了几年，还是提前刷了部分题熟悉下。 绝大部分题都是有在 minikube 的环境上操作过，只有部分比如升级集群受限于环境问题没有实地操作。 写在最前 保存常用文档进书签，如果有 Alfred 启用浏览器书签 workflow。 …"><meta property="og:image" content="https://atbug.com/images/thumbnails/kubernetes.png"><link rel=apple-touch-icon sizes=180x180 href=https://atbug.com/icons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=https://atbug.com/icons/favicon-32x32.png><link rel=manifest href=https://atbug.com/icons/site.webmanifest><link rel=canonical href=https://atbug.com/notes-for-cka-preparation/><link rel=preload href=https://atbug.com/css/styles.f447efe4c4b72136d91de28493ae7ef4ecc0c35f80359801224320ede7871c488414b1dfba5913dffd7a1ed5f70440802a87e8795f124086b949e35e6579b5d9.css integrity="sha512-9Efv5MS3ITbZHeKEk65+9OzAw1+ANZgBIkMg7eeHHEiEFLHfulkT3/16HtX3BECAKofoeV8SQIa5SeNeZXm12Q==" as=style crossorigin=anonymous><link rel=preload href=https://atbug.com/js/bundle.min.90cbe84f27859868a1c2f20af76ac2cc69c32540555dbbdae845870af41ba688e06385e7e720680cc34e65b9fdd5381585b444e33c735f35d05e6c5dc7d7bdc0.js as=script integrity="sha512-kMvoTyeFmGihwvIK92rCzGnDJUBVXbva6EWHCvQbpojgY4Xn5yBoDMNOZbn91TgVhbRE4zxzXzXQXmxdx9e9wA==" crossorigin=anonymous><link rel=stylesheet type=text/css href=https://atbug.com/css/styles.f447efe4c4b72136d91de28493ae7ef4ecc0c35f80359801224320ede7871c488414b1dfba5913dffd7a1ed5f70440802a87e8795f124086b949e35e6579b5d9.css integrity="sha512-9Efv5MS3ITbZHeKEk65+9OzAw1+ANZgBIkMg7eeHHEiEFLHfulkT3/16HtX3BECAKofoeV8SQIa5SeNeZXm12Q==" crossorigin=anonymous></head><body data-code=100 data-lines=true id=documentTop><header class=nav_header><nav class=nav><a href=https://atbug.com/ class="nav_brand nav_item" title=乱世浮生><img src=https://atbug.com/logo.png class=logo alt=乱世浮生><div class=nav_close><div><svg class="icon"><use xlink:href="#open-menu"/></svg><svg class="icon"><use xlink:href="#closeme"/></svg></div></div></a><div class="nav_body nav_body_left"><div class=nav_parent><a href=https://atbug.com/ class=nav_item title=Home>Home</a></div><div class=nav_parent><a href=https://atbug.com/post/ class=nav_item title=Archives>Archives</a></div><div class=nav_parent><a href=https://atbug.com/about/ class=nav_item title=About>About</a></div><div class=follow><a href=https://github.com/addozhang><svg class="icon"><use xlink:href="#github"/></svg></a><a href=https://twitter.com/duwasai><svg class="icon"><use xlink:href="#twitter"/></svg></a><a href=https://atbug.com/index.xml><svg class="icon"><use xlink:href="#rss"/></svg></a><div class=color_mode><input type=checkbox class=color_choice id=mode></div></div></div></nav></header><main><div class="grid-inverse wrap content"><article class=post_content><h1 class=post_title>Kubernetes CKA 证书备考笔记</h1><div class=post_meta><span><svg class="icon"><use xlink:href="#calendar"/></svg></span><span class=post_date>Jul 2, 2021</span>
<span class=post_time>· 20 min read&nbsp;</span>
<span>·
<a href=https://atbug.com/tags/kubernetes title=Kubernetes class="post_tag button button_translucent">Kubernetes</a> ·
<a href=https://atbug.com/tags/cka title=CKA class="post_tag button button_translucent">CKA</a></span>
<span class=page_only>·</span></div><img src=https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/06/30/pexelsskitterphoto419635.jpg class=image_featured alt="Kubernetes CKA 证书备考笔记"><h2>文章目录</h2><nav id=TableOfContents><ul><li><a href=#写在最前>写在最前</a></li><li><a href=#安全rbac>安全：RBAC</a><ul><li><a href=#知识点>知识点</a></li><li><a href=#解题思路>解题思路</a></li></ul></li><li><a href=#多容器-pod>多容器 Pod</a><ul><li><a href=#知识点-1>知识点</a></li><li><a href=#解题思路-1>解题思路</a></li></ul></li><li><a href=#安全网络策略-networkpolicy>安全：网络策略 NetworkPolicy</a><ul><li><a href=#知识点-2>知识点</a></li><li><a href=#解题思路-2>解题思路</a></li></ul></li><li><a href=#节点状态及污点>节点状态及污点</a><ul><li><a href=#知识点-3>知识点</a></li><li><a href=#解题思路-3>解题思路</a></li></ul></li><li><a href=#资源>资源</a><ul><li><a href=#知识点-4>知识点</a></li><li><a href=#解题思路-4>解题思路</a></li></ul></li><li><a href=#网络dns>网络：DNS</a><ul><li><a href=#知识点-5>知识点</a></li><li><a href=#解题思路-5>解题思路</a></li></ul></li><li><a href=#工作负载扩容>工作负载：扩容</a><ul><li><a href=#知识点-6>知识点</a></li><li><a href=#解题思路-6>解题思路</a></li></ul></li><li><a href=#集群备份及恢复>集群备份及恢复</a><ul><li><a href=#知识点-7>知识点</a></li><li><a href=#解题思路-7>解题思路</a></li></ul></li><li><a href=#集群节点升级>集群节点升级</a><ul><li><a href=#知识点-8>知识点</a></li><li><a href=#解题思路-8>解题思路</a></li></ul></li><li><a href=#集群节点故障排查>集群：节点故障排查</a><ul><li><a href=#知识点-9>知识点</a></li><li><a href=#解题思路-9>解题思路</a></li></ul></li><li><a href=#存储持久化卷>存储：持久化卷</a><ul><li><a href=#知识点-10>知识点</a></li><li><a href=#解题思路-10>解题思路</a></li></ul></li><li><a href=#工作负载多容器的-deployment>工作负载：多容器的 Deployment</a><ul><li><a href=#知识点-11>知识点</a></li><li><a href=#解题思路-11>解题思路</a></li></ul></li><li><a href=#存储secret的使用>存储：Secret的使用</a><ul><li><a href=#知识点-12>知识点</a></li><li><a href=#解题思路-12>解题思路</a></li></ul></li><li><a href=#工作负载静态-pod>工作负载：静态 Pod</a><ul><li><a href=#知识点-13>知识点</a></li><li><a href=#解题思路-13>解题思路</a></li></ul></li><li><a href=#调度污点和容忍度>调度：污点和容忍度</a><ul><li><a href=#知识点-14>知识点</a></li><li><a href=#解题思路-14>解题思路</a></li></ul></li><li><a href=#kubectl-命令和排序>kubectl 命令和排序</a><ul><li><a href=#知识点-15>知识点</a></li><li><a href=#解题思路-15>解题思路</a></li></ul></li><li><a href=#存储持久化卷和挂载>存储：持久化卷和挂载</a><ul><li><a href=#知识点-16>知识点</a></li><li><a href=#解题思路-16>解题思路</a></li></ul></li><li><a href=#kubectl-命令和-context>kubectl 命令和 context</a><ul><li><a href=#知识点-17>知识点</a></li><li><a href=#解题思路-17>解题思路</a></li></ul></li><li><a href=#工作负载缩容>工作负载：缩容</a><ul><li><a href=#知识点-18>知识点</a></li><li><a href=#解题思路-18>解题思路</a></li></ul></li><li><a href=#应用就绪和探活>应用就绪和探活</a><ul><li><a href=#知识点-19>知识点</a></li><li><a href=#解题思路-19>解题思路</a></li></ul></li><li><a href=#集群控制平面>集群：控制平面</a><ul><li><a href=#知识点-20>知识点</a></li><li><a href=#解题思路-20>解题思路</a></li></ul></li><li><a href=#集群pod-调度>集群：Pod 调度</a><ul><li><a href=#知识点-21>知识点</a></li><li><a href=#解题思路-21>解题思路</a></li></ul></li><li><a href=#集群备份及恢复-1>集群：备份及恢复</a><ul><li><a href=#知识点-22>知识点</a></li><li><a href=#解题思路-22>解题思路</a></li></ul></li><li><a href=#安全网络策略>安全：网络策略</a><ul><li><a href=#知识点-23>知识点</a></li><li><a href=#解题思路-23>解题思路</a></li></ul></li><li><a href=#集群kubelet-启动方式>集群：kubelet 启动方式</a></li><li><a href=#知识点-24>知识点</a><ul><li><a href=#解题思路-24>解题思路</a></li></ul></li><li><a href=#集群证书>集群：证书</a><ul><li><a href=#知识点-25>知识点</a></li><li><a href=#解题思路-25>解题思路</a></li></ul></li><li><a href=#集群升级节点>集群：升级节点</a><ul><li><a href=#知识点-26>知识点</a></li><li><a href=#解题思路-26>解题思路</a></li></ul></li><li><a href=#docker-命令>Docker 命令</a><ul><li><a href=#知识点-27>知识点</a></li><li><a href=#解题思路-27>解题思路</a></li></ul></li></ul></nav><p>Kubernetes 使用有好几年了，但在今年 5 月才完成 CKA 的考试。虽说用了几年，还是提前刷了部分题熟悉下。</p><p>绝大部分题都是有在 minikube 的环境上操作过，只有部分比如升级集群受限于环境问题没有实地操作。</p><h2 id=写在最前>写在最前</h2><ol><li>保存常用文档进书签，如果有 Alfred 启用浏览器书签 workflow。效果见下图</li><li>kubectl 自动补全 <code>echo "source &lt;(kubectl completion bash)" >> ~/.bashrc; source ~/.bashrc</code></li><li>每道题开始前要切换 context 和 namespace，直接复制题目里的命令即可</li><li>必要的 alias</li><li>善用 <code>--dry-run=client -o yaml</code> 避免手动敲太多</li><li>善用 <code>kubectl explain [resource[.field]]</code></li><li>看懂题目最重要，输出正确的结果更重要（重要的事讲三遍）</li><li>看懂题目最重要，输出正确的结果更重要（重要的事讲三遍）</li><li>看懂题目最重要，输出正确的结果更重要（重要的事讲三遍）</li></ol><p>书签地址：<a href=https://gist.github.com/addozhang/3ca950ce9b38930abfe7c5fb067e74de>K8s-CKA-CAKD-Bookmarks.html</a></p><p><img src=https://atbug.oss-cn-hangzhou.aliyuncs.com/2021/07/01/20210630162758.png alt=alfred-bookmarks-workflow></p><h2 id=安全rbac>安全：RBAC</h2><blockquote><p>在默认命名空间中创建一个名为 dev-sa 的服务帐户，dev-sa 可以在 dev 命名空间中创建以下组件：
<code>Deployment</code>、<code>StatefulSet</code>、<code>DaemonSet</code></p></blockquote><h3 id=知识点>知识点</h3><ul><li>role</li><li>sa</li><li>rolebinding</li><li>auth can-i</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/reference/access-authn-authz/rbac/#command-line-utilities>https://kubernetes.io/docs/reference/access-authn-authz/rbac/#command-line-utilities</a></p><h3 id=解题思路>解题思路</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl create sa dev-sa
$ kubectl create role dev-role --verb<span class=o>=</span>create --resource<span class=o>=</span>deployment,statefulset,daemonset
<span class=c1>#检查</span>
$ kubectl describe role dev-role
Name:         dev-role
Labels:       &lt;none&gt;
Annotations:  &lt;none&gt;
PolicyRule:
  Resources          Non-Resource URLs  Resource Names  Verbs
  ---------          -----------------  --------------  -----
  daemonsets.apps    <span class=o>[]</span>                 <span class=o>[]</span>              <span class=o>[</span>create<span class=o>]</span>
  deployments.apps   <span class=o>[]</span>                 <span class=o>[]</span>              <span class=o>[</span>create<span class=o>]</span>
  statefulsets.apps  <span class=o>[]</span>                 <span class=o>[]</span>              <span class=o>[</span>create<span class=o>]</span>
  
$ kubectl create rolebinding dev --serviceaccount default:dev-sa --role dev-role

<span class=c1>#检查</span>
$ kubectl auth can-i create deployment --as system:serviceaccount:default:dev-sa
yes
$ kubectl auth can-i create statefulset --as system:serviceaccount:default:dev-sa
yes
$ kubectl auth can-i create daemonset --as system:serviceaccount:default:dev-sa
yes
$ kubectl auth can-i create pod --as system:serviceaccount:default:dev-sa
no
</code></pre></div><h2 id=多容器-pod>多容器 Pod</h2><blockquote><p>创建一个pod名称日志，容器名称 <code>log-pro</code> 使用image <code>busybox</code>，在 <code>/log/data/output.log</code> 输出重要信息。然后另一个容器名称 <code>log-cus</code> 使用 image <code>busybox</code>，在 <code>/log/data/output.log</code> 加载 <code>output.log</code> 并打印它。 请注意，此日志文件只能在 pod 内共享。</p></blockquote><h3 id=知识点-1>知识点</h3><ul><li>pod</li><li>volume: emptyDir</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/concepts/storage/volumes/#emptydir>https://kubernetes.io/docs/concepts/storage/volumes/#emptydir</a></p><h3 id=解题思路-1>解题思路</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>kubectl run log --image busybox --dry-run<span class=o>=</span>client -o yaml &gt; log.yaml
</code></pre></div><p>修改 log.yaml</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>log</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>log</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>command</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>sh</span><span class=w>
</span><span class=w>    </span>- -<span class=l>c</span><span class=w>
</span><span class=w>    </span>- <span class=l>echo important information &gt; /log/data/output.log; sleep 1d</span><span class=w>
</span><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>log-pro</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>    </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/log/data</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>log</span><span class=w>
</span><span class=w>  </span>- <span class=nt>command</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>sh</span><span class=w>
</span><span class=w>    </span>- -<span class=l>c</span><span class=w>
</span><span class=w>    </span>- <span class=l>tail -f /log/data/output.log</span><span class=w>
</span><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>log-cus</span><span class=w>
</span><span class=w>    </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/log/data</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>log</span><span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>log</span><span class=w>
</span><span class=w>    </span><span class=nt>emptyDir</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><p>执行创建 <code>kubectl apply -f log.yaml</code></p><p>检查</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl logs log -c log-cus
important information
</code></pre></div><h2 id=安全网络策略-networkpolicy>安全：网络策略 NetworkPolicy</h2><blockquote><p>只有命名空间 <code>mysql</code> 的 pod 只能被另一个命名空间 <code>internal</code> 的 pod 通过 8080 端口进行访问</p></blockquote><h3 id=知识点-2>知识点</h3><ul><li>NetworkPolicy</li><li>Ingress</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/concepts/services-networking/network-policies/#the-networkpolicy-resource>https://kubernetes.io/docs/concepts/services-networking/network-policies/#the-networkpolicy-resource</a></p><h3 id=解题思路-2>解题思路</h3><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkPolicy</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>cka-network</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>target</span><span class=w> </span><span class=c>#目的命名空间</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>podSelector</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>  </span><span class=nt>policyTypes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=l>Ingress</span><span class=w> </span><span class=c>#策略影响入栈流量</span><span class=w>
</span><span class=w>  </span><span class=nt>ingress</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>from</span><span class=p>:</span><span class=w> </span><span class=c>#允许流量的来源</span><span class=w>
</span><span class=w>    </span>- <span class=nt>namespaceSelector</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>ns</span><span class=p>:</span><span class=w> </span><span class=l>source</span><span class=w> </span><span class=c>#源命名空间的 label</span><span class=w>
</span><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>8080</span><span class=w> </span><span class=c>#允许访问的端口</span><span class=w>
</span><span class=w>
</span></code></pre></div><h2 id=节点状态及污点>节点状态及污点</h2><blockquote><p>统计这个集群中没有污染的就绪节点，并输出到文件 <code>/root/cka/readyNode.txt</code>。</p></blockquote><h3 id=知识点-3>知识点</h3><ul><li>Node</li><li>Taint（污点）</li></ul><p>参考文档：https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/</p><h3 id=解题思路-3>解题思路</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># Ready 状态的数量</span>
$ kubectl get node <span class=p>|</span> grep -w Ready <span class=p>|</span> wc -l
<span class=c1># 查看含有 Taint 的数量，需要排除掉这些</span>
$ kubectl describe node <span class=p>|</span> grep Taints <span class=p>|</span> grep -i NoSchedule <span class=p>|</span> wc -l
</code></pre></div><h2 id=资源>资源</h2><blockquote><p>将占用CPU资源最多的pod名称输出到文件 <code>/root/cka/name.txt</code></p></blockquote><h3 id=知识点-4>知识点</h3><ul><li>kubectl top 命令</li><li>metrics</li></ul><h3 id=解题思路-4>解题思路</h3><p>如果是 minikube 环境，报错 <code>error: Metrics API not available</code>，可以执行 <code>minikube addons enable metrics-server</code> 命令开启 metrics server。</p><p>通过 <code>kubectl top</code> 命令找到 cpu 最高的 pod，将其名字写入 <code>/root/cka/name.txt</code>。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl top pod
<span class=c1># 或者</span>
$ kubectl top pod <span class=p>|</span> sort -k <span class=m>2</span> -n
</code></pre></div><h2 id=网络dns>网络：DNS</h2><blockquote><p>有 pod 名称 <code>pod-nginx</code>，创建服务名称 <code>service-nginx</code>，使用 <code>nodePort</code> 暴露pod。 然后创建一个 pod 使用 image <code>busybox</code> 来 <code>nslookup</code> pod <code>pod-nginx</code> 和 service <code>service-nginx</code>。</p></blockquote><h3 id=知识点-5>知识点</h3><ul><li>service with nodePort</li><li>kubectl expose</li><li>kubectl run</li></ul><p>参考文档：https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/</p><h3 id=解题思路-5>解题思路</h3><p>使用 <code>kubectl expose</code> 创建 service。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># 创建 service</span>
kubectl expose pod pod-nginx --name service-nginx --type NodePort --target-port <span class=m>80</span>
<span class=c1># 创建 pod</span>
kubectl run busybox --image busybox:latest --command sleep 1h
</code></pre></div><p>获取 pod 的 ip 地址，pod 的 dns lookup 需要用用到 ip。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get po -o wide
NAME        READY   STATUS    RESTARTS   AGE     IP           NODE   NOMINATED NODE   READINESS GATES
busybox     1/1     Running   <span class=m>0</span>          2m17s   172.17.0.5   cka    &lt;none&gt;           &lt;none&gt;
pod-nginx   1/1     Running   <span class=m>0</span>          59m     172.17.0.4   cka    &lt;none&gt;           &lt;none&gt;
</code></pre></div><p>执行 nslookup</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl <span class=nb>exec</span> busybox -it -- nslookup 172.17.0.4
4.0.17.172.in-addr.arpa	<span class=nv>name</span> <span class=o>=</span> 172-17-0-4.service-nginx.default.svc.cluster.local.

$ kubectl <span class=nb>exec</span> busybox -it -- nslookup service-nginx
Server:		10.96.0.10
Address:	10.96.0.10#53

Name:	service-nginx.default.svc.cluster.local
Address: 10.110.253.70
</code></pre></div><h2 id=工作负载扩容>工作负载：扩容</h2><blockquote><p>将命名空间 <code>dev</code> 中的 Deployment <code>scale-deploy</code> 缩放到三个 pod 并记录下来。</p></blockquote><p>参考文档：https://kubernetes.io/docs/concepts/workloads/controllers/deployment/#scaling-a-deployment</p><h3 id=知识点-6>知识点</h3><ul><li>deployment scale up</li><li>kubectl scale</li></ul><h3 id=解题思路-6>解题思路</h3><p><code>kubectl scale</code> 的使用，需要参数 <code>--record</code> 进行记录（将操作命令记录到 deployment 的 <code>kubernetes.io/change-cause</code> annotation 中）。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl scale deployment scale-deploy --replicas <span class=m>3</span> --record
</code></pre></div><h2 id=集群备份及恢复>集群备份及恢复</h2><blockquote><p>备份 etcd 并将其保存在主节点上的 <code>/root/cka/etcd-backup.db</code>。</p></blockquote><blockquote><p>最后恢复备份。</p></blockquote><h3 id=知识点-7>知识点</h3><ul><li>etcd 的备份及恢复</li></ul><p>参考文档：https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster</p><h3 id=解题思路-7>解题思路</h3><p>Kubernetes 的所有数据都记录在 etcd 中，对 etcd 进行备份就是对集群进行备份。</p><p>连接 etcd 需要证书，证书可以从 apiserver 获取，因为 apiserver 需要连接 etcd。新版本的 apiserver 都是以 static pod 的方式运行，证书是通过 volume 挂载到 pod 中的。</p><p>比如 minikube 环境，证书是从 node 节点的 <code>/var/lib/minikube/certs</code> 挂载进去的。</p><p>要先 ssh 到 master 节点上。命令的执行非常快，如果长时间没结束，那就说名有问题了。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#备份</span>
$ <span class=nv>ETCDCTL_API</span><span class=o>=</span><span class=m>3</span> etcdctl snapshot save /root/cka/etcd-backup.db <span class=se>\
</span><span class=se></span>--endpoints<span class=o>=</span>https://127.0.0.1:2379 <span class=se>\
</span><span class=se></span>--cacert<span class=o>=</span>/var/lib/minikube/certs/etcd/ca.crt <span class=se>\
</span><span class=se></span>--cert<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.crt <span class=se>\
</span><span class=se></span>--key<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.key
</code></pre></div><p>由于只说了 restore，所以就执行 restore 的命令，默认会恢复到当前目录的 <code>default.etcd</code> 下。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#恢复</span>
$ <span class=nv>ETCDCTL_API</span><span class=o>=</span><span class=m>3</span> etcdctl snapshot restore /root/cka/etcd-backup.db <span class=se>\
</span><span class=se></span>--endpoints<span class=o>=</span>https://127.0.0.1:2379 <span class=se>\
</span><span class=se></span>--cacert<span class=o>=</span>/var/lib/minikube/certs/etcd/ca.crt <span class=se>\
</span><span class=se></span>--cert<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.crt <span class=se>\
</span><span class=se></span>--key<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.key
</code></pre></div><h2 id=集群节点升级>集群节点升级</h2><blockquote><p>将master节点版本从 1.20.0 升级到 1.21.0，确保 master 节点上的 pod 重新调度到其他节点，升级完成后，使 master 节点可用。</p></blockquote><h3 id=知识点-8>知识点</h3><ul><li>drain</li><li>cordon</li></ul><p>参考文档：https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-upgrade/#upgrading-control-plane-nodes</p><h3 id=解题思路-8>解题思路</h3><p>受限于环境，没有实地操作。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># 将节点设置为不可调度</span>
$ kubectl cordon master
<span class=c1># 驱逐 master 节点上的 pod</span>
$ kubectl drain master --ignore-daemonsets

<span class=c1># 进行升级</span>
$ apt-mark unhold kubelet kubectl <span class=o>&amp;&amp;</span> <span class=se>\
</span><span class=se></span>apt-get update <span class=o>&amp;&amp;</span> apt-get install -y <span class=nv>kubelet</span><span class=o>=</span>1.21.0-00 <span class=nv>kubectl</span><span class=o>=</span>1.21.0-00 <span class=o>&amp;&amp;</span> <span class=se>\
</span><span class=se></span>apt-mark hold kubelet kubectl
<span class=c1># 重新启动kubelet</span>
$ systemctl daemon-reload
$ systemctl restart kubelet

<span class=c1># 将节点设置为可调度</span>
$ kubectl uncordon master
</code></pre></div><h2 id=集群节点故障排查>集群：节点故障排查</h2><blockquote><p>现在 node01 还没有准备好，请找出根本原因并使其准备好，然后创建一个确保它在 node01 上运行的 pod。</p></blockquote><h3 id=知识点-9>知识点</h3><ul><li>节点故障排查</li></ul><h3 id=解题思路-9>解题思路</h3><p>这种问题大概率问题出在 kubelet 上</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>ssh node01
systemctl status kubelet
systemctl restart kubelet
<span class=c1># 再检查node状态</span>
</code></pre></div><p>插播一个故障，本地安装 2 个节点的 minikube 集群时，第二个节点持续 <code>NotReady</code>。使用 <code>systemctl status kubelet</code> 看到 <code>unable to update cni config: no networks found in /etc/cni/net.mk</code>。</p><p>检查该目录确实没有文件，从 master 节点复制到该节点后重启 kubelet 解决。</p><h2 id=存储持久化卷>存储：持久化卷</h2><blockquote><p>集群中有一个持久卷名称 <code>dev-pv</code>，创建一个持久卷声明名称 <code>dev-pvc</code>，确保这个持久卷声明会绑定持久卷，然后创建一个 pod 名称 <code>test-pvc</code>，将这个 pvc 挂载到 path <code>/tmp/data</code>，使用 nginx 镜像。</p></blockquote><h3 id=知识点-10>知识点</h3><ul><li>PersistentVolume</li><li>PersistentVolumeClaim</li><li>Mount Volume</li></ul><p>参考文档：https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolume</p><h3 id=解题思路-10>解题思路</h3><p>创建 pvc 前先获取 pv的信息</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pv dev-pv -o yaml
</code></pre></div><p>创建 pv</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cat &gt; pvc.yaml <span class=s>&lt;&lt;EOF
</span><span class=s>apiVersion: v1
</span><span class=s>kind: PersistentVolumeClaim
</span><span class=s>metadata:
</span><span class=s>  name: dev-pvc
</span><span class=s>spec:
</span><span class=s>  accessModes:
</span><span class=s>    - ReadWriteOnce
</span><span class=s>  resources:
</span><span class=s>    requests:
</span><span class=s>      storage: 1Gi
</span><span class=s>EOF</span>

$ kubectl apply -f pvc.yaml
</code></pre></div><p>创建 pod 的 manifest，记得使用 <code>kubectl run --dry-run=client -o yaml</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>kubectl run test-pvc --image nginx --dry-run<span class=o>=</span>client -o yaml &gt; test-pvc.yaml
</code></pre></div><p>修改之后得到最终的 pod yaml</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>test-pvc</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-pvc</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span><span class=w>      </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class=l>dev-pvc</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>test-pvc</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span><span class=w>        </span><span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/data</span><span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span></code></pre></div><p>理论上只要 pod 能运行，就说明成功。也可以进一步确认挂载是否成功，在 pod 的 <code>/tmp/data</code> 中 touch 个文件，然后到节点的目录中查看是有该文件。</p><h2 id=工作负载多容器的-deployment>工作负载：多容器的 Deployment</h2><blockquote><p>创建一个名为 <code>deploy-important</code> 的 Deployment，标签为 <code>id=very-important</code>（pod 也应该有这个标签）和命名空间 dev 中的 3 个副本。 它应该包含两个容器，第一个名为 <code>container1</code> 并带有镜像，第二个名为 container2 的图像为 <code>kubernetes/pause</code>。</p></blockquote><blockquote><p>在一个工作节点上应该只运行该部署的一个 Pod。 我们有两个工作节点：<code>cluster1-worker1</code> 和 <code>cluster1-worker2</code>。 因为 Deployment 有三个副本，所以结果应该是在两个节点上都有一个 Pod 正在运行。 不会调度第三个 Pod，除非添加新的工作节点。</p></blockquote><h3 id=知识点-11>知识点</h3><ul><li>deployment</li><li>pod label</li><li>replicas</li><li>multi container pod</li><li>pod anti affinity</li></ul><p>官方文档参考：https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#never-co-located-in-the-same-node</p><h3 id=解题思路-11>解题思路</h3><p>先创建模板</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl create deployment deploy-important --image nginx --replicas <span class=m>3</span> --dry-run<span class=o>=</span>client -o yaml &gt; deploy-important.yaml
</code></pre></div><p>修改后的 yaml</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>deploy-important</span><span class=w>
</span><span class=w>    </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>very-important</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>deploy-important</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>3</span><span class=w>
</span><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>deploy-important</span><span class=w>
</span><span class=w>      </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>very-important</span><span class=w>
</span><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>deploy-important</span><span class=w>
</span><span class=w>        </span><span class=nt>id</span><span class=p>:</span><span class=w> </span><span class=l>very-important</span><span class=w>
</span><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>affinity</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>podAntiAffinity</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>requiredDuringSchedulingIgnoredDuringExecution</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=nt>labelSelector</span><span class=p>:</span><span class=w>
</span><span class=w>              </span><span class=nt>matchExpressions</span><span class=p>:</span><span class=w>
</span><span class=w>              </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>id</span><span class=w>
</span><span class=w>                </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>In</span><span class=w>
</span><span class=w>                </span><span class=nt>values</span><span class=p>:</span><span class=w>
</span><span class=w>                </span>- <span class=l>very-important</span><span class=w>
</span><span class=w>            </span><span class=nt>topologyKey</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes.io/hostname</span><span class=w>
</span><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container1</span><span class=w>
</span><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>kubernetes/pause</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>container2</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><p>minikube 上测试只能调度一个 pod，符合预期</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kgpo
NAME                                READY   STATUS    RESTARTS   AGE
deploy-important-659d54fc47-6cp8r   0/2     Pending   <span class=m>0</span>          3h10m
deploy-important-659d54fc47-92z4d   2/2     Running   <span class=m>0</span>          3h10m
deploy-important-659d54fc47-c6llc   0/2     Pending   <span class=m>0</span>          3h10m
</code></pre></div><h2 id=存储secret的使用>存储：Secret的使用</h2><blockquote><p>在 <code>secret</code> 命名空间下，使用镜像 <code>busybox:1.31.1</code> 创建一个名为 <code>secret-pod</code> 的 pod，并保证 pod 运行一段时间</p></blockquote><blockquote><p>有个名为 <code>sercret1.yaml</code> 的 Secret 文件，在 <code>secret</code> 命名空间下创建 Secret，并以只读的方式挂在到 Pod 的 <code>/tmp/secret1</code> 目录
创建一个新的 Secret <code>secret2</code> 包含 <code>user=user1</code> 和 <code>pass=1234</code>，分别以缓解变量 <code>APP_USER</code> 和 <code>APP_PASS</code> 输入到 Pod 中</p></blockquote><h3 id=知识点-12>知识点</h3><ul><li>secret</li><li>toleration</li><li>taints</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets>https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets</a>
<a href=https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables>https://kubernetes.io/docs/concepts/configuration/secret/#using-secrets-as-environment-variables</a></p><h3 id=解题思路-12>解题思路</h3><p>创建 namespace</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl create ns secret
</code></pre></div><p>创建 pod 模板</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubectl run secret-pod --image busybox:1.31.1 --dry-run=client -o yaml --command -- sleep 1d &gt; secret-pod.yaml
</code></pre></div><p>修改 secret1.yaml，使用 secret namespace</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>data</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>halt</span><span class=p>:</span><span class=w> </span><span class=l>IyEvYmluL2Jhc2g=</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Secret</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-05-15T07:48:02Z&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret1</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>secret</span><span class=w>
</span><span class=w></span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>Opaque</span><span class=w>
</span></code></pre></div><p>创建 secret2</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl create secret generic secret2 --from-literal <span class=nv>user</span><span class=o>=</span>user1 --from-literal <span class=nv>pass</span><span class=o>=</span><span class=m>1234</span>
</code></pre></div><p>修改模板</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>secret-pod</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret-pod</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>command</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>sleep</span><span class=w>
</span><span class=w>    </span>- <span class=l>1d</span><span class=w>
</span><span class=w>    </span><span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>busybox:1.31.1</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret-pod</span><span class=w>
</span><span class=w>    </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>APP_USER</span><span class=w>
</span><span class=w>      </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret2</span><span class=w>
</span><span class=w>          </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>user</span><span class=w>
</span><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>APP_PASS</span><span class=w>
</span><span class=w>      </span><span class=nt>valueFrom</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>secretKeyRef</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>secret2</span><span class=w>
</span><span class=w>          </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>pass</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/secret1</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sec</span><span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>sec</span><span class=w>
</span><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>secret1</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><p>检查结果：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl <span class=nb>exec</span> secret-pod -- cat /tmp/secret1/halt
<span class=c1>#!/bin/bash</span>

$ kubectl <span class=nb>exec</span> secret-pod -- env <span class=p>|</span> grep <span class=s1>&#39;APP_&#39;</span>
<span class=nv>APP_USER</span><span class=o>=</span>user1
<span class=nv>APP_PASS</span><span class=o>=</span><span class=m>1234</span>
</code></pre></div><h2 id=工作负载静态-pod>工作负载：静态 Pod</h2><blockquote><p>在 <code>cluster3-master1</code> 上的 <code>default</code> 命名空间中创建一个名为 <code>my-static-pod</code> 的静态 Pod。 使用镜像 <code>nginx:1.16-alpine</code> 并分配 10m CPU 和 20Mi 内存的资源。</p></blockquote><blockquote><p>Then create a NodePort Service named static-pod-service which exposes that static Pod on port 80 and check if it has Endpoints and if its reachable through the cluster3-master1 internal IP address. You can connect to the internal node IPs from your main terminal.
然后创建一个名为<code> static-pod-service</code> 的 NodePort Service，该服务在端口 80 上公开该静态 Pod，并检查它是否具有端点以及是否可以通过 <code>cluster3-master1</code> 内部 IP 地址访问它。</p></blockquote><h3 id=知识点-13>知识点</h3><ul><li>static pod</li><li>resource</li><li>nodeport service</li><li>endpoints</li></ul><p>参考文档：</p><ul><li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/>https://kubernetes.io/docs/tasks/configure-pod-container/static-pod/</a></li><li><a href=https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-memory>https://kubernetes.io/docs/concepts/configuration/manage-resources-containers/#meaning-of-memory</a></li></ul><h3 id=解题思路-13>解题思路</h3><p>创建pod模板</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run my-static-pod --image nginx:1.16-alpine --dry-run<span class=o>=</span>client -o yaml &gt; static-pod.yaml
</code></pre></div><p>修改模板，增加资源配置</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>my-static-pod</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-static-pod</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.16-alpine</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>my-static-pod</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>cpu</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;10m&#34;</span><span class=w>
</span><span class=w>        </span><span class=nt>memory</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;20Mi&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><p>ssh 到主机，找到 kubelet 配置文件的位置 <code>ps -ef | grep kubelet</code></p><p>查看配置文件（minikube：/var/lib/kubelet/config.yaml）中 <code>staticPodPath</code> 配置的就是静态 pod 的 manifest 的位置（minikube：/etc/kubernetes/manifests）</p><p>将 <code>static-pod.yaml</code> 放到正确的文件夹中，然后重启 kubelet</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ systemctl restart kubelet
</code></pre></div><p>检查pod是否正确运行</p><p>创建 node port</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl expose pod my-static-pod --name static-pod-service --type NodePort --port <span class=m>80</span>
</code></pre></div><p>检查是否创建成功</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get svc
NAME                 TYPE        CLUSTER-IP     EXTERNAL-IP   PORT<span class=o>(</span>S<span class=o>)</span>        AGE
static-pod-service   NodePort    10.97.248.99   &lt;none&gt;        80:31938/TCP   68s
</code></pre></div><p>获取 node 的 ip</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get node -o wide
NAME   STATUS   ROLES    AGE   VERSION   INTERNAL-IP    EXTERNAL-IP   OS-IMAGE               KERNEL-VERSION   CONTAINER-RUNTIME
cka    Ready    master   10h   v1.18.8   192.168.64.3   &lt;none&gt;        Buildroot 2020.02.10   4.19.171         docker://20.10.4
</code></pre></div><p>在 minikube 的环境下可直接通过 <code>minikube ip</code> 获取</p><p>测试</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ http 192.168.64.3:31938 --headers
HTTP/1.1 <span class=m>200</span> OK
Accept-Ranges: bytes
Connection: keep-alive
Content-Length: <span class=m>612</span>
Content-Type: text/html
Date: Sat, <span class=m>15</span> May <span class=m>2021</span> 08:35:11 GMT
ETag: <span class=s2>&#34;5d52db33-264&#34;</span>
Last-Modified: Tue, <span class=m>13</span> Aug <span class=m>2019</span> 15:45:55 GMT
Server: nginx/1.16.1
</code></pre></div><h2 id=调度污点和容忍度>调度：污点和容忍度</h2><blockquote><p>在命名空间 <code>default</code> 中创建图像 <code>httpd:2.4.41-alpine</code> 的单个 Pod。Pod 应命名为 <code>pod1</code>，容器名为 <code>pod1-container</code>。在不给任何节点添加新标签的前提下，将该 pod 调度到主节点上。</p></blockquote><h3 id=知识点-14>知识点</h3><ul><li>Taint</li><li>Label</li><li>Tolerance</li></ul><p>参考文档：https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/</p><h3 id=解题思路-14>解题思路</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>#找出master节点（一般考试只有一个节点）
$ kubectl get node
#找到 master 节点的 taints，需要在 pod 的 .spec.tolerations 排除掉
$ kubectl describe node xxxx | grep -w Taints
#找到 master 节点的 labels
$ kubectl describe node xxxx | grep -w Labels -A10
</code></pre></div><p>创建pod模板</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run pod1 --image httpd:2.4.41-alpine --dry-run<span class=o>=</span>client -o yaml &gt; pod1.yaml
</code></pre></div><p>修改模板： 这里假设主节点的 Taint 为 <code>node-role.kubernetes.io/master=:NoSchedule</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># minikube 集群名为 cka，主节点同名</span>
$ kubectl describe node cka <span class=p>|</span> grep -i taint
Taints:             node-role.kubernetes.io/master:NoSchedule
</code></pre></div><p>最终的 pod 如下</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>pod1</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod1</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>httpd:2.4.41-alpine</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>pod1</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>tolerations</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node-role.kubernetes.io/master</span><span class=w>
</span><span class=w>    </span><span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoSchedule</span><span class=w>
</span><span class=w>  </span><span class=nt>nodeSelector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>node-role.kubernetes.io/master</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><p>最后检查下是否调度到主节点上：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod -o wide
NAME   READY   STATUS    RESTARTS   AGE    IP           NODE   NOMINATED NODE   READINESS GATES
pod1   1/1     Running   <span class=m>0</span>          102s   10.244.0.3   cka    &lt;none&gt;           &lt;none&gt;
</code></pre></div><h2 id=kubectl-命令和排序>kubectl 命令和排序</h2><blockquote><p>所有命名空间中都有各种 Pod。 将命令写入 /opt/course/5/find_pods.sh，其中列出所有按 AGE 排序的 Pod（metadata.creationTimestamp）。</p></blockquote><blockquote><p>将第二个命令写入 /opt/course/5/find_pods_uid.sh，其中列出按字段 metadata.uid 排序的所有 Pod。对这两个命令都使用 kubectl 排序。</p></blockquote><h3 id=知识点-15>知识点</h3><ul><li>kubectl 命令的使用，主要是 <code>--all-namespaces</code> （缩写 <code>-A</code>） 和 <code>--sort-by</code></li></ul><h3 id=解题思路-15>解题思路</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cat &gt; /opt/course/5/find_pods.sh <span class=s>&lt;&lt;EOF
</span><span class=s>kubectl get pod -A --sort-by &#39;.metadata.creationTimestamp&#39;
</span><span class=s>EOF</span>
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cat &gt; /opt/course/5/find_pods_uid.sh <span class=s>&lt;&lt;EOF
</span><span class=s>kubectl get pod -A --sort-by &#39;.metadata.uid&#39;
</span><span class=s>EOF</span> 
</code></pre></div><h2 id=存储持久化卷和挂载>存储：持久化卷和挂载</h2><blockquote><p>创建一个名为 <code>safari-pv</code> 的新 <code>PersistentVolume</code>。它应该具有 2Gi 的容量、<code>accessMode</code> <code>ReadWriteOnce</code>、<code>hostPath</code> <code>/Volumes/Data</code> 并且没有定义 <code>storageClassName</code>。</p></blockquote><blockquote><p>接下来在命名空间 <code>project-tiger</code> 中创建一个名为 <code>safari-pvc</code> 的新 <code>PersistentVolumeClaim</code>。 它应该请求 2Gi 存储，<code>accessMode</code> <code>ReadWriteOnce</code> 并且不应定义 <code>storageClassName</code>。 PVC 应该正确绑定到 PV。</p></blockquote><blockquote><p>最后在命名空间 <code>project-tiger</code> 中创建一个新的 Deployment <code>safari</code>，它将该卷挂载到 <code>/tmp/safari-data</code>。该 Deployment 的 Pod 应该是镜像 httpd:2.4.41-alpine。</p></blockquote><h3 id=知识点-16>知识点</h3><ul><li>pv</li><li>pvc</li><li>pod 使用 pvc</li><li>deployment</li><li>mount PVC volume</li></ul><p>参考文档：</p><ul><li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolume>https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolume</a></li><li><a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolumeclaim>https://kubernetes.io/docs/tasks/configure-pod-container/configure-persistent-volume-storage/#create-a-persistentvolumeclaim</a></li><li><a href=https://kubernetes.io/docs/concepts/storage/persistent-volumes/#claims-as-volumes>https://kubernetes.io/docs/concepts/storage/persistent-volumes/#claims-as-volumes</a></li></ul><h3 id=解题思路-16>解题思路</h3><p>创建 pv</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PersistentVolume</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>safari-pv</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>local</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>capacity</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>2Gi</span><span class=w>
</span><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>ReadWriteOnce</span><span class=w>
</span><span class=w>  </span><span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;/Volumes/Data&#34;</span><span class=w>
</span></code></pre></div><p>创建 pvc</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>PersistentVolumeClaim</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>safari-pvc</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>accessModes</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=l>ReadWriteOnce</span><span class=w>
</span><span class=w>  </span><span class=nt>resources</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>requests</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>storage</span><span class=p>:</span><span class=w> </span><span class=l>2Gi</span><span class=w>
</span></code></pre></div><p>检查是否绑定成功</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pvc
NAME         STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
safari-pvc   Bound    pvc-d4c15825-2de3-470f-8ed0-9519cacaad21   2Gi        RWO            standard       24s
</code></pre></div><p>创建 deployment 模板</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl create deployment safari --image httpd:2.4.41-alpine --dry-run<span class=o>=</span>client -o yaml
</code></pre></div><p>最终的yaml</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>apps/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Deployment</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>safari</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>safari</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>replicas</span><span class=p>:</span><span class=w> </span><span class=m>1</span><span class=w>
</span><span class=w>  </span><span class=nt>selector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>safari</span><span class=w>
</span><span class=w>  </span><span class=nt>strategy</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>  </span><span class=nt>template</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>      </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>safari</span><span class=w>
</span><span class=w>    </span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>httpd:2.4.41-alpine</span><span class=w>
</span><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>httpd</span><span class=w>
</span><span class=w>        </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>        </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>        </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/tmp/safari-data</span><span class=w>
</span><span class=w>          </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span><span class=w>      </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>data</span><span class=w>
</span><span class=w>        </span><span class=nt>persistentVolumeClaim</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>claimName</span><span class=p>:</span><span class=w> </span><span class=l>safari-pvc</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><h2 id=kubectl-命令和-context>kubectl 命令和 context</h2><blockquote><p>可以通过 kubectl 上下文从主终端访问多个集群。将所有这些上下文名称写入 /opt/course/1/contexts。</p></blockquote><blockquote><p>接下来在 /opt/course/1/context_default_kubectl.sh 中写一个显示当前上下文的命令，该命令应该使用kubectl。</p></blockquote><blockquote><p>最后在 /opt/course/1/context_default_no_kubectl.sh 中写入第二个执行相同操作的命令，但不使用 kubectl。</p></blockquote><h3 id=知识点-17>知识点</h3><p>kubectl config 相关命令的使用</p><h3 id=解题思路-17>解题思路</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>kubectl config get-contexts -o name &gt; /opt/course/1/contexts
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>cat &gt; /opt/course/1/context_default_kubectl.sh <span class=s>&lt;&lt;EOF
</span><span class=s>kubectl config current-context
</span><span class=s>EOF</span>

chmod +x /opt/course/1/context_default_kubectl.sh
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>cat ~/.kube/config <span class=p>|</span> grep current-context <span class=p>|</span> awk <span class=s1>&#39;{print $2}&#39;</span>
</code></pre></div><h2 id=工作负载缩容>工作负载：缩容</h2><blockquote><p>命名空间 <code>project-c13</code> 中有两个名为 <code>o3db-*</code> 的 Pod。 C13 管理层要求将 Pod 缩减为一个副本以节省资源。 记录动作。</p></blockquote><h3 id=知识点-18>知识点</h3><ul><li>scale</li><li>deploy</li><li>statefulset</li></ul><p>参考文档：
<a href=https://kubernetes.io/zh/docs/tasks/run-application/scale-stateful-set/>https://kubernetes.io/zh/docs/tasks/run-application/scale-stateful-set/</a>
<a href=https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#scaling-a-deployment>https://kubernetes.io/zh/docs/concepts/workloads/controllers/deployment/#scaling-a-deployment</a></p><h3 id=解题思路-18>解题思路</h3><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>kubectl scale &lt;resource&gt; xxx --replicas<span class=o>=</span><span class=m>1</span>
</code></pre></div><p>scale 命令需要确认资源类型：deployment/statefulset</p><h2 id=应用就绪和探活>应用就绪和探活</h2><blockquote><p>在命名空间 <code>default</code> 中执行以下操作。为 <code>nginx:1.16.1-alpine</code> 创建一个名为 <code>ready-if-service-ready</code> 的 Pod。配置一个 <code>LivenessProbe</code>，它只是运行 <code>true</code>。还要配置一个 <code>ReadinessProbe</code> 来检查 <code>url</code> <code>http://service-am-i-ready:80</code> 是否可达，可以使用 <code>wget -T2 -O- http://service-am-i-ready:80</code>。 启动 Pod 并确认它因为 <code>ReadinessProbe</code> 而没有准备好。</p></blockquote><blockquote><p>创建第二个名为 <code>am-i-ready</code> 的 Pod 镜像 <code>nginx:1.16.1-alpine</code>，标签 <code>id:cross-server-ready</code>。已经存在的服务 <code>service-am-i-ready</code> 现在应该有第二个 Pod 作为端点。</p></blockquote><h3 id=知识点-19>知识点</h3><ul><li>probe</li><li>pod</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/>https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/</a></p><h3 id=解题思路-19>解题思路</h3><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>kubectl run ready-if-service-ready --image nginx:1.16.1-alpine --dry-run=client -o yaml &gt; ready-if-service-ready.yaml

kubectl run am-i-ready --image nginx:1.16.1-alpine --labels id=cross-server-ready --dry-run=client -o yaml &gt; am-i-ready.yaml
</code></pre></div><p>添加 probes</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=kc>null</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>ready-if-service-ready</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ready-if-service-ready</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>nginx:1.16.1-alpine</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>ready-if-service-ready</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>    </span><span class=nt>livenessProbe</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=l>echo</span><span class=w>
</span><span class=w>          </span>- <span class=l>hi</span><span class=w>
</span><span class=w>    </span><span class=nt>readinessProbe</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>exec</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>command</span><span class=p>:</span><span class=w>
</span><span class=w>          </span>- <span class=l>wget</span><span class=w>
</span><span class=w>          </span>- -<span class=l>T2</span><span class=w>
</span><span class=w>          </span>- -<span class=l>O-</span><span class=w>
</span><span class=w>          </span>- <span class=l>http://service-am-i-ready:80</span><span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><h2 id=集群控制平面>集群：控制平面</h2><blockquote><p>使用 <code>ssh cluster1-master1</code> ssh 进入主节点。检查 master 组件 kubelet、kube-apiserver、kube-scheduler、kube-controller-manager 和 etcd 如何在 master 节点上启动/安装。还要找出 DNS 应用的名称以及它是如何在主节点上启动/安装的。</p></blockquote><blockquote><p>将结果写入文件 /opt/course/8/master-components.txt。该文件的结构应如下所示：</p></blockquote><blockquote><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback># /opt/course/8/master-components.txt
kubelet: [TYPE]
kube-apiserver: [TYPE]
kube-scheduler: [TYPE]
kube-controller-manager: [TYPE]
etcd: [TYPE]
dns: [TYPE] [NAME]
</code></pre></div></blockquote><blockquote><p>Choices of [TYPE] are: not-installed, process, static-pod, pod</p></blockquote><h3 id=知识点-20>知识点</h3><p>Kubernetes components 的安装方式</p><h3 id=解题思路-20>解题思路</h3><p>当前比较的组件都是以static pod的形式运行的，而 static pod 都是由 Kubelet 管理的，所以从 kubelet 处入手。</p><p>以 minikube 为例：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ ps -ef <span class=p>|</span> grep -w kubelet
root      <span class=m>140597</span>       <span class=m>1</span>  <span class=m>2</span> May15 ?        00:36:00 /var/lib/minikube/binaries/v1.18.8/kubelet --bootstrap-kubeconfig<span class=o>=</span>/etc/kubernetes/bootstrap-kubelet.conf --config<span class=o>=</span>/var/lib/kubelet/config.yaml --container-runtime<span class=o>=</span>docker --hostname-override<span class=o>=</span>cka --kubeconfig<span class=o>=</span>/etc/kubernetes/kubelet.conf --node-ip<span class=o>=</span>192.168.64.3

$ systemctl is-active kubelet
active
<span class=c1>#kubelet: process</span>
</code></pre></div><p>根据前面进程中的信息，查看 <code>/var/lib/kubelet/config.yaml</code>中的内容。可以得到：</p><p>etcd: static-pod
kube-apiserver: static-pod
kube-controller-manager: static-pod</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ cat /var/lib/kubelet/config.yaml <span class=p>|</span> grep -i staticpod
staticPodPath: /etc/kubernetes/manifests

ls /etc/kubernetes/manifests
etcd.yaml  kube-apiserver.yaml	kube-controller-manager.yaml  kube-scheduler.yaml
</code></pre></div><p>最后上下dns，查看下pod，得知 dns: pod</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod -A <span class=p>|</span> grep dns
kube-system   coredns-66bff467f8-6k2br      1/1     Running   <span class=m>0</span>          32h
</code></pre></div><p>最后将上面的结果写入到 <code>/opt/course/8/master-components.txt</code>，不能前功尽弃。</p><h2 id=集群pod-调度>集群：Pod 调度</h2><blockquote><p>使用 <code>ssh cluster2-master1</code> ssh 进入主节点。暂时停止 <code>kube-scheduler</code>，这意味着可以在之后再次启动它。</p></blockquote><blockquote><p>为镜像 <code>httpd:2.4-alpine</code> 创建一个名为 <code>manual-schedule</code> 的 Pod，确认它已启动但未在任何节点上调度。</p></blockquote><blockquote><p>现在您是调度程序并拥有所有权力，在节点 <code>cluster2-master1</code> 上手动调度该 Pod。 确保它正在运行。</p></blockquote><blockquote><p>再次启动 <code>kube-scheduler</code> 并通过在镜像 <code>httpd:2.4-alpine</code> 创建第二个名为 <code>manual-schedule2</code> 的 Pod 并检查它是否在 <code>cluster2-worker1</code> 上运行来确认其运行正常。</p></blockquote><h3 id=知识点-21>知识点</h3><ul><li>kubernetes 组件的运行方式</li><li>创建 pod</li><li>pod 调度</li></ul><h3 id=解题思路-21>解题思路</h3><p>kube-scheduler 是以 static pod 的方式运行，因此我们需要 ssh 到节点上，将 scheduler 的 yaml 移出（记住不要删掉，还要还原回去），重启 kubelet</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ ps -ef <span class=p>|</span> grep -w kubelet
root      <span class=m>140597</span>       <span class=m>1</span>  <span class=m>2</span> May15 ?        00:36:00 /var/lib/minikube/binaries/v1.18.8/kubelet --bootstrap-kubeconfig<span class=o>=</span>/etc/kubernetes/bootstrap-kubelet.conf --config<span class=o>=</span>/var/lib/kubelet/config.yaml --container-runtime<span class=o>=</span>docker --hostname-override<span class=o>=</span>cka --kubeconfig<span class=o>=</span>/etc/kubernetes/kubelet.conf --node-ip<span class=o>=</span>192.168.64.3

$ cat /var/lib/kubelet/config.yaml <span class=p>|</span> grep -i staticpod
staticPodPath: /etc/kubernetes/manifests

$ ls /etc/kubernetes/manifests
etcd.yaml  kube-apiserver.yaml	kube-controller-manager.yaml  kube-scheduler.yaml

$ mv /etc/kubernetes/manifests/kube-scheduler.yaml /etc/kubernetes

$ systemctl restart kubelet
</code></pre></div><p>检查下 schedule pod 没有运行，然后尝试创建 pod，并查看 pod 处于 pending 状态，即没有 kube-scheduler 为其调度。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run manual-schedule --image httpd:2.4-alpine

$ kubectl get pod <span class=p>|</span> grep manual-schedule
manual-schedule          0/1     Pending   <span class=m>0</span>          16s
</code></pre></div><p>手动调度，即为 pod 指定一个 <code>nodeName</code>，我的 minikube 只有一个 node 名为 cka，修改pod：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod manual-schedule -o yaml &gt; manual-schedule.yaml
</code></pre></div><p>添加 nodeName 之后</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>Pod</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>creationTimestamp</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;2021-05-16T07:27:16Z&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>labels</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class=l>manual-schedule</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>manual-schedule</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>dev</span><span class=w>
</span><span class=w>  </span><span class=nt>resourceVersion</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;84805&#34;</span><span class=w>
</span><span class=w>  </span><span class=nt>selfLink</span><span class=p>:</span><span class=w> </span><span class=l>/api/v1/namespaces/dev/pods/manual-schedule</span><span class=w>
</span><span class=w>  </span><span class=nt>uid</span><span class=p>:</span><span class=w> </span><span class=l>c4b592f6-1e07-4911-a7fe-867d813c7a55</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>containers</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>image</span><span class=p>:</span><span class=w> </span><span class=l>httpd:2.4-alpine</span><span class=w>
</span><span class=w>    </span><span class=nt>imagePullPolicy</span><span class=p>:</span><span class=w> </span><span class=l>IfNotPresent</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>manual-schedule</span><span class=w>
</span><span class=w>    </span><span class=nt>resources</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>    </span><span class=nt>terminationMessagePath</span><span class=p>:</span><span class=w> </span><span class=l>/dev/termination-log</span><span class=w>
</span><span class=w>    </span><span class=nt>terminationMessagePolicy</span><span class=p>:</span><span class=w> </span><span class=l>File</span><span class=w>
</span><span class=w>    </span><span class=nt>volumeMounts</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>mountPath</span><span class=p>:</span><span class=w> </span><span class=l>/var/run/secrets/kubernetes.io/serviceaccount</span><span class=w>
</span><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default-token-v7f28</span><span class=w>
</span><span class=w>      </span><span class=nt>readOnly</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>  </span><span class=nt>dnsPolicy</span><span class=p>:</span><span class=w> </span><span class=l>ClusterFirst</span><span class=w>
</span><span class=w>  </span><span class=nt>nodeName</span><span class=p>:</span><span class=w> </span><span class=l>cka</span><span class=w> </span><span class=c>#node name here</span><span class=w>
</span><span class=w>  </span><span class=nt>enableServiceLinks</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>  </span><span class=nt>priority</span><span class=p>:</span><span class=w> </span><span class=m>0</span><span class=w>
</span><span class=w>  </span><span class=nt>restartPolicy</span><span class=p>:</span><span class=w> </span><span class=l>Always</span><span class=w>
</span><span class=w>  </span><span class=nt>schedulerName</span><span class=p>:</span><span class=w> </span><span class=l>default-scheduler</span><span class=w>
</span><span class=w>  </span><span class=nt>securityContext</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span><span class=w>  </span><span class=nt>serviceAccount</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span><span class=w>  </span><span class=nt>serviceAccountName</span><span class=p>:</span><span class=w> </span><span class=l>default</span><span class=w>
</span><span class=w>  </span><span class=nt>terminationGracePeriodSeconds</span><span class=p>:</span><span class=w> </span><span class=m>30</span><span class=w>
</span><span class=w>  </span><span class=nt>tolerations</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoExecute</span><span class=w>
</span><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node.kubernetes.io/not-ready</span><span class=w>
</span><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>Exists</span><span class=w>
</span><span class=w>    </span><span class=nt>tolerationSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span><span class=w>  </span>- <span class=nt>effect</span><span class=p>:</span><span class=w> </span><span class=l>NoExecute</span><span class=w>
</span><span class=w>    </span><span class=nt>key</span><span class=p>:</span><span class=w> </span><span class=l>node.kubernetes.io/unreachable</span><span class=w>
</span><span class=w>    </span><span class=nt>operator</span><span class=p>:</span><span class=w> </span><span class=l>Exists</span><span class=w>
</span><span class=w>    </span><span class=nt>tolerationSeconds</span><span class=p>:</span><span class=w> </span><span class=m>300</span><span class=w>
</span><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>default-token-v7f28</span><span class=w>
</span><span class=w>    </span><span class=nt>secret</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>defaultMode</span><span class=p>:</span><span class=w> </span><span class=m>420</span><span class=w>
</span><span class=w>      </span><span class=nt>secretName</span><span class=p>:</span><span class=w> </span><span class=l>default-token-v7f28</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>phase</span><span class=p>:</span><span class=w> </span><span class=l>Pending</span><span class=w>
</span><span class=w>  </span><span class=nt>qosClass</span><span class=p>:</span><span class=w> </span><span class=l>BestEffort</span><span class=w>
</span></code></pre></div><p>强制更新 pod（运行时只能修改部分内容）：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl replace -f manual-schedule.yaml --force
pod <span class=s2>&#34;manual-schedule&#34;</span> deleted
pod/manual-schedule replaced
</code></pre></div><p>再次检查</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod <span class=p>|</span> grep manual-schedule
manual-schedule          1/1     Running   <span class=m>0</span>          15s
</code></pre></div><p>恢复 kube-scheduler 的运行：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ mv /etc/kubernetes/kube-scheduler.yaml /etc/kubernetes/manifests
$ systemctl restart kubelet
</code></pre></div><p>检查是否运行</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod -A <span class=p>|</span> grep kube-scheduler
kube-system   kube-scheduler-cka            1/1     Running   <span class=m>0</span>          66s
</code></pre></div><p>创建第二个pod，并检查是否在运行（running）状态</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run manual-schedule2 --image httpd:2.4-alpine
pod/manual-schedule2 created

kubectl get pod manual-schedule2
NAME               READY   STATUS    RESTARTS   AGE
manual-schedule2   1/1     Running   <span class=m>0</span>          6s
</code></pre></div><h2 id=集群备份及恢复-1>集群：备份及恢复</h2><blockquote><p>对在 <code>cluster3-master1</code> 上运行的 etcd 进行备份，并将其保存在主节点上的 <code>/tmp/etcd-backup.db</code>。</p></blockquote><blockquote><p>然后在集群中创建一个你喜欢的 Pod。</p></blockquote><blockquote><p>最后恢复备份，确认集群仍在工作并且创建的 Pod 不再与我们在一起。</p></blockquote><h3 id=知识点-22>知识点</h3><ul><li>etc 的作用：存储集群的状态信息，包括 pod 信息</li><li>etc 的备份和恢复</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster>https://kubernetes.io/docs/tasks/administer-cluster/configure-upgrade-etcd/#backing-up-an-etcd-cluster</a></p><h3 id=解题思路-22>解题思路</h3><p>etcd的命令执行，记得设置API的版本 <code>ETCDCTL_API=3</code></p><p>操作 etcd 需要 <code>endpoints</code>、<code>cacert</code>、<code>cert</code>、<code>key</code>。Kubernetes 的所有组件与 etcd 的数据交互都是通过 api-server 完成的，我只需要找到 api-server 的运行命令就行，两种方式：到 master 主机查看 api-server 的进程；或者去 api-server 的 pod 查看 <code>.spec.containers[].command</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#ssh to master</span>
$ ps -ef <span class=p>|</span> grep kube-apiserver

$ kubectl get pod -n kube-system kube-apiserver-cka -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.containers[].command}&#39;</span>
</code></pre></div><p>etcd 备份，命令直接从 Kubernetes 官方文档复制再修改</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#ssh to master</span>

<span class=nv>$ETCDCTL_API</span><span class=o>=</span><span class=m>3</span> etcdctl --endpoints<span class=o>=</span>https://127.0.0.1:2379 <span class=se>\
</span><span class=se></span>  --cacert<span class=o>=</span>/var/lib/minikube/certs/etcd/ca.crt --cert<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.crt --key<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.key <span class=se>\
</span><span class=se></span>  snapshot save /tmp/etcd-backup.db
Snapshot saved at /tmp/etcd-backup.db
</code></pre></div><p>创建 pod</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run sleep1d --image busybox --command -- sleep 1d
<span class=c1>#检查 pod 运行情况</span>
$ kubectl get pod
NAME      READY   STATUS    RESTARTS   AGE
sleep1d   1/1     Running   <span class=m>0</span>          10s
</code></pre></div><p>恢复 etcd 的备份，复制前面的命令并修改，恢复备份到 <code>/var/lib/etcd-backup</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ <span class=nv>ETCDCTL_API</span><span class=o>=</span><span class=m>3</span> etcdctl --endpoints<span class=o>=</span>https://127.0.0.1:2379 --cacert<span class=o>=</span>/var/lib/minikube/certs/etcd/ca.crt --cert<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.crt --key<span class=o>=</span>/var/lib/minikube/certs/apiserver-etcd-client.key snapshot restore /tmp/etcd-backup.db --data-dir /var/lib/etcd-backup
2021-05-16 08:09:17.797061 I <span class=p>|</span> mvcc: restore compact to <span class=m>85347</span>
2021-05-16 08:09:17.803208 I <span class=p>|</span> etcdserver/membership: added member 8e9e05c52164694d <span class=o>[</span>http://localhost:2380<span class=o>]</span> to cluster cdf818194e3a8c32
</code></pre></div><p>修改 etcd 的配置， <code>/etc/kubernetes/manifests/etcd.yaml</code></p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=w>  </span><span class=nt>volumes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/minikube/certs/etcd</span><span class=w>
</span><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>DirectoryOrCreate</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>etcd-certs</span><span class=w>
</span><span class=w>  </span>- <span class=nt>hostPath</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>path</span><span class=p>:</span><span class=w> </span><span class=l>/var/lib/etcd-backup </span><span class=w> </span><span class=c>#原来是/var/lib/minikube/etcd</span><span class=w>
</span><span class=w>      </span><span class=nt>type</span><span class=p>:</span><span class=w> </span><span class=l>DirectoryOrCreate</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>etcd-data</span><span class=w>
</span><span class=w></span><span class=nt>status</span><span class=p>:</span><span class=w> </span>{}<span class=w>
</span></code></pre></div><p>保存后重启kubelet</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ systemctl restart kubelet
</code></pre></div><p>检查pod是否存在：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod sleep1d
Error from server <span class=o>(</span>NotFound<span class=o>)</span>: pods <span class=s2>&#34;sleep1d&#34;</span> not found
</code></pre></div><h2 id=安全网络策略>安全：网络策略</h2><blockquote><p>发生了一起安全事件，入侵者能够从一个被黑的后端 Pod 访问整个集群。</p></blockquote><blockquote><p>为了防止这种情况，在命名空间 <code>project-snake</code> 中创建一个名为 <code>np-backend</code> 的 <code>NetworkPolicy</code>。它应该只允许 <code>backend-*</code> Pods：</p></blockquote><blockquote><p>连接到端口 <code>1111</code> 上的 <code>db1-*</code> Pod
连接到端口 <code>2222</code> 上的 <code>db2-*</code> Pod
在策略中使用 Pod 的应用程序标签。</p></blockquote><blockquote><p>实施后，例如，端口 3333 上从 <code>backend-*</code> Pod 到 <code>vault-*</code> Pod 的连接应该不再有效。</p></blockquote><h3 id=知识点-23>知识点</h3><ul><li>NetworkPolicy</li></ul><p>参考文档：
<a href=https://kubernetes.io/docs/concepts/services-networking/network-policies>https://kubernetes.io/docs/concepts/services-networking/network-policies</a></p><h3 id=解题思路-23>解题思路</h3><p>为 backend-* pod 设置 egress 的 NetworkPolicy，只允许其访问 db1-* 的 1111 端口和 db2-* 的 2222 端口，策略中使用 app label 来进行匹配。</p><p>从 Kubernetes 官网文档中复制一段yaml配置进行修改。</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkPolicy</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>np-backend</span><span class=w>
</span><span class=w>  </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class=l>project-snake</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>backend</span><span class=w>
</span><span class=w>  </span><span class=nt>policyTypes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=l>Egress</span><span class=w>
</span><span class=w>  </span><span class=nt>egress</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>db1</span><span class=w>
</span><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>1111</span><span class=w>
</span><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w>                
</span><span class=w>    </span>- <span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>db2          </span><span class=w>
</span><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>2222</span><span class=w>      
</span></code></pre></div><p>假设 backend pod 的 app label 为 backend，db1 的 为 db1，db2 的为 db2。</p><p>创建环境：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run backend --image nginx --labels <span class=nv>app</span><span class=o>=</span>backend
$ kubectl run db1 --image nginx --labels <span class=nv>app</span><span class=o>=</span>db1
$ kubectl run db2 --image nginx --labels <span class=nv>app</span><span class=o>=</span>db2
$ kubectl run vault --image nginx --labels <span class=nv>app</span><span class=o>=</span>vault

$ kubectl get pod -L app
NAME      READY   STATUS              RESTARTS   AGE   APP
backend   1/1     Running   <span class=m>0</span>          13s   backend
db1       1/1     Running             <span class=m>0</span>          66s   db1
db2       1/1     Running             <span class=m>0</span>          71s   db2
vault     1/1     Running             <span class=m>0</span>          79s   vault
</code></pre></div><p>由于我们用的 nginx 镜像，将前面的 NetworkPolicy 端口修改一下：</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=nt>apiVersion</span><span class=p>:</span><span class=w> </span><span class=l>networking.k8s.io/v1</span><span class=w>
</span><span class=w></span><span class=nt>kind</span><span class=p>:</span><span class=w> </span><span class=l>NetworkPolicy</span><span class=w>
</span><span class=w></span><span class=nt>metadata</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>np-backend</span><span class=w>
</span><span class=w></span><span class=nt>spec</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>      </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>backend</span><span class=w>
</span><span class=w>  </span><span class=nt>policyTypes</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=l>Egress</span><span class=w>
</span><span class=w>  </span><span class=nt>egress</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>db1</span><span class=w>
</span><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span><span class=w>  </span>- <span class=nt>to</span><span class=p>:</span><span class=w>                
</span><span class=w>    </span>- <span class=nt>podSelector</span><span class=p>:</span><span class=w>
</span><span class=w>        </span><span class=nt>matchLabels</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>app</span><span class=p>:</span><span class=w> </span><span class=l>db2          </span><span class=w>
</span><span class=w>    </span><span class=nt>ports</span><span class=p>:</span><span class=w>
</span><span class=w>    </span>- <span class=nt>protocol</span><span class=p>:</span><span class=w> </span><span class=l>TCP</span><span class=w>
</span><span class=w>      </span><span class=nt>port</span><span class=p>:</span><span class=w> </span><span class=m>80</span><span class=w>
</span></code></pre></div><p>检查一下：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get networkpolicy
NAME         POD-SELECTOR   AGE
np-backend   <span class=nv>app</span><span class=o>=</span>backend    31s
</code></pre></div><p>测试下网络：</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#获取pod ip</span>
$ kubectl get pod -o wide
NAME      READY   STATUS    RESTARTS   AGE     IP           NODE   NOMINATED NODE   READINESS GATES
backend   1/1     Running   <span class=m>0</span>          3m15s   172.17.0.7   cka    &lt;none&gt;           &lt;none&gt;
db1       1/1     Running   <span class=m>0</span>          4m8s    172.17.0.6   cka    &lt;none&gt;           &lt;none&gt;
db2       1/1     Running   <span class=m>0</span>          4m13s   172.17.0.3   cka    &lt;none&gt;           &lt;none&gt;
vault     1/1     Running   <span class=m>0</span>          4m21s   172.17.0.4   cka    &lt;none&gt;           &lt;none&gt;

</code></pre></div><h2 id=集群kubelet-启动方式>集群：kubelet 启动方式</h2><blockquote><p>节点 <code>cluster2-worker1</code> 已使用 kubeadm 和 TLS 引导添加到集群中。
找到 <code>cluster2-worker1</code> 的 “Issuer” 和 “Extended Key Usage” 值：
kubelet 客户端证书，用于向外连接到 kube-apiserver 的证书。
kubelet 服务器证书，用于来自 kube-apiserver 的传入连接。
将信息写入文件 <code>/opt/course/23/certificate-info.txt</code>。</p></blockquote><h2 id=知识点-24>知识点</h2><ul><li>kubelet 的功能：连接 api-server；接受来自 api-server 的响应。两种情况都需要 TLS</li></ul><h3 id=解题思路-24>解题思路</h3><p>kubelet 连接 apiserver 的方式在配置文件中，先找出配置文件的保存位置。</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1># ssh 到节点上，查看 kubelet 的启动命令</span>
$ ps -ef <span class=p>|</span> grep kubelet
root        <span class=m>3935</span>       <span class=m>1</span>  <span class=m>1</span> 12:54 ?        00:00:23 /var/lib/minikube/binaries/v1.20.0/kubelet --bootstrap-kubeconfig<span class=o>=</span>/etc/kubernetes/bootstrap-kubelet.conf --cni-conf-dir<span class=o>=</span>/etc/cni/net.mk --config<span class=o>=</span>/var/lib/kubelet/config.yaml --container-runtime<span class=o>=</span>docker --hostname-override<span class=o>=</span>cka-m02 --kubeconfig<span class=o>=</span>/etc/kubernetes/kubelet.conf --network-plugin<span class=o>=</span>cni --node-ip<span class=o>=</span>192.168.64.9
docker     <span class=m>13653</span>   <span class=m>13616</span>  <span class=m>0</span> 13:22 pts/0    00:00:00 grep kubelet
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell><span class=c1>#kubelet 连接 api server 的信息， client cert 的配置所在 /var/lib/kubelet/pki/kubelet-client-current.pem</span>
cat /var/lib/kubelet/config.yaml 
<span class=c1>#kubelet 的启动信息， servert cert 的配置所在 /var/lib/minikube/certs/ca.crt</span>
cat /etc/kubernetes/kubelet.conf 
</code></pre></div><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ openssl x509 -noout -text -in /var/lib/kubelet/pki/kubelet-client-current.pem <span class=p>|</span> grep -i issuer
        Issuer: <span class=nv>CN</span> <span class=o>=</span> minikubeCA
$ openssl x509 -noout -text -in /var/lib/kubelet/pki/kubelet-client-current.pem <span class=p>|</span> grep -i -A1 extended
            X509v3 Extended Key Usage:
                TLS Web Client Authentication

$ openssl x509 -noout -text -in /var/lib/minikube/certs/ca.crt <span class=p>|</span> grep -i issuer
        Issuer: <span class=nv>CN</span> <span class=o>=</span> minikubeCA
$ openssl x509 -noout -text -in /var/lib/minikube/certs/ca.crt <span class=p>|</span> grep -i -A1 extended
            X509v3 Extended Key Usage:
                TLS Web Client Authentication, TLS Web Server Authentication
</code></pre></div><p>最后记得将信息写入到 <code>/opt/course/23/certificate-info.txt</code></p><h2 id=集群证书>集群：证书</h2><blockquote><p>检查 kube-apiserver 服务器证书在 <code>cluster2-master1</code> 上的有效期。使用 openssl 或 cfssl 执行此操作。将到期日期写入 <code>/opt/course/22/expiration</code>。</p></blockquote><blockquote><p>同时运行正确的 kubeadm 命令以列出到期日期并确认两种方法显示相同的日期。</p></blockquote><blockquote><p>将更新 apiserver 服务器证书的正确 kubeadm 命令写入 <code>/opt/course/22/kubeadm-renew-certs.sh</code>。</p></blockquote><h3 id=知识点-25>知识点</h3><ul><li>api-server</li><li>openssl</li><li>kubeadm</li></ul><p>参考文档：https://kubernetes.io/docs/tasks/administer-cluster/kubeadm/kubeadm-certs/#check-certificate-expiration</p><h3 id=解题思路-25>解题思路</h3><p>通过 kube-apiserver pod 的启动命令，或者 ssh 到 master 来查看命令参数，<code>tls-cert-file=/var/lib/minikube/certs/apiserver.crt</code></p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ openssl x509 -noout -text -in /var/lib/minikube/certs/apiserver.crt <span class=p>|</span> grep -i valid -A2
        Validity
            Not Before: May <span class=m>13</span> 22:33:43 <span class=m>2021</span> GMT
            Not After : May <span class=m>14</span> 22:33:43 <span class=m>2022</span> GMT
</code></pre></div><p>将 <code>May 14 22:33:43 2022 GMT</code> 写入 <code>/opt/course/22/expiration</code></p><p>通过 kubeadm 来检查</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>$ kubeadm certs check-expiration | grep -i apiserver
#macos 无法安装 kubeadm
#minikube 无法使用 kubeadm 检查
</code></pre></div><p>将 <code>kubeadm certs renew apiserver</code> 写入 /opt/course/22/kubeadm-renew-certs.sh</p><h2 id=集群升级节点>集群：升级节点</h2><blockquote><p>你的同事说节点 <code>cluster3-worker2</code> 运行的是较旧的 Kubernetes 版本，甚至不属于集群的一部分。将 kubectl 和 kubeadm 更新为在 <code>cluster3-master1</code> 上运行的确切版本。然后将此节点添加到集群中，您可以为此使用kubeadm。</p></blockquote><h3 id=知识点-26>知识点</h3><ul><li>kubeadm 升级集群</li></ul><p>参考文档：</p><h3 id=解题思路-26>解题思路</h3><p>检查node</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get nodes
</code></pre></div><p>检查当前组件版本</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ ssh cluster3-worker2

$ kubeadm version
$ kubectl version --short
Client Version: vx.xx.x
Server Version: vx.xx.x

$ kubelet --version
</code></pre></div><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>#使用命令并升级各个组件，并重启 kubelet
#如果启动失败，一般是需要token连接到api-server，需要ssh到master上运行 kubeadm create token --print-join-command
#再ssh到 node上，执行打印的命令，重启kubelet并检查装填
#最后检查node是否成功加入集群
</code></pre></div><h2 id=docker-命令>Docker 命令</h2><blockquote><p>在命名空间 <code>project-tiger</code> 中创建一个名为 <code>Tigers-reunite</code> 的 Pod 镜像 <code>httpd:2.4.41-alpine</code>，标签为 <code>pod=container</code> 和 <code>container=pod</code>。找出 Pod 被安排在哪个节点上。ssh 进入该节点并找到属于该 Pod 的 docker 容器。</p></blockquote><blockquote><p>将容器的 docker ID 和这些正在运行的进程/命令写入 <code>/opt/course/17/pod-container.txt</code>。</p></blockquote><blockquote><p>最后，使用 docker 命令将主 Docker 容器（来自 yaml 中指定的那个）的日志写入 <code>/opt/course/17/pod-container.log</code>。</p></blockquote><h3 id=知识点-27>知识点</h3><ul><li>docker 命令：ps、logs、inspect</li></ul><h3 id=解题思路-27>解题思路</h3><p>创建 pod</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl run tigers-reunite --image httpd:2.4.41-alpine --labels <span class=nv>pod</span><span class=o>=</span>container,container<span class=o>=</span>pod
</code></pre></div><p>检查 pod 的信息</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pods --show-labels
NAME             READY   STATUS    RESTARTS   AGE   LABELS
tigers-reunite   1/1     Running   <span class=m>0</span>          34s   <span class=nv>container</span><span class=o>=</span>pod,pod<span class=o>=</span>container
</code></pre></div><p>获取pod所在的节点</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>$ kubectl get pod tigers-reunite -o <span class=nv>jsonpath</span><span class=o>=</span><span class=s1>&#39;{.spec.nodeName}&#39;</span>
cka
</code></pre></div><p>ssh到节点上</p><div class=highlight><pre class=chroma><code class=language-shell data-lang=shell>docker ps <span class=p>|</span> grep tigers-reunite
e6ff69b437bc   54b0995a6305           <span class=s2>&#34;httpd-foreground&#34;</span>       About a minute ago   Up About a minute             k8s_tigers-reunite_tigers-reunite_dev_53391212-911d-4275-a19d-e8f8b0f85a98_0
06d3ca65eb08   k8s.gcr.io/pause:3.2   <span class=s2>&#34;/pause&#34;</span>                 About a minute ago   Up About a minute             k8s_POD_tigers-reunite_dev_53391212-911d-4275-a19d-e8f8b0f85a98_0

<span class=c1>#使用docker inspect 或者 进入容器直接查看进程</span>
$ docker inspect e6ff69b437bc <span class=p>|</span> grep -i <span class=s1>&#39;cmd\|entrypoint&#39;</span> -A1
            <span class=s2>&#34;Cmd&#34;</span>: <span class=o>[</span>
                <span class=s2>&#34;httpd-foreground&#34;</span>
--
            <span class=s2>&#34;Entrypoint&#34;</span>: null,
            <span class=s2>&#34;OnBuild&#34;</span>: null,
                
$ docker inspect 06d3ca65eb08 <span class=p>|</span> grep -i <span class=s1>&#39;cmd\|entrypoint&#39;</span> -A1
            <span class=s2>&#34;Cmd&#34;</span>: null,
            <span class=s2>&#34;Image&#34;</span>: <span class=s2>&#34;k8s.gcr.io/pause:3.2&#34;</span>,
--
            <span class=s2>&#34;Entrypoint&#34;</span>: <span class=o>[</span>
                <span class=s2>&#34;/pause&#34;</span>
</code></pre></div><p>结果写入文件</p><div class=highlight><pre class=chroma><code class=language-fallback data-lang=fallback>e6ff69b437bc httpd-foreground
06d3ca65eb08 pause
</code></pre></div><p>写日志到文件</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=l>docker logs e6ff69b437bc &gt; /opt/course/17/pod-container.log</span><span class=w>
</span></code></pre></div><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return}var b=document,a=b.createElement('script');a.async=!0,a.src='//addozhang.disqus.com/embed.js',a.setAttribute('data-timestamp',+new Date),(b.head||b.body).appendChild(a)})()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article><aside class=sidebar><section class=sidebar_inner><h2>张晓辉</h2><div class=sidebar_description><ul><li>资深码农、云原生践行者</li><li>Kubernetes、DevOps、微服务</li></ul><p>微信订阅号：云原生指北。
<img src=../images/wechat_qr.jpg alt></div><a href=https://atbug.com/about/ class="button mt-1" role=button title=阅读更多>阅读更多</a><h2 class=mt-4>最新文章</h2><ul class=flex-column><li><a href=https://atbug.com/setup-kubernetes-running-with-isulad-on-openeuler/ class=nav-link title="ARM64 平台基于 openEuler + iSula 环境部署 Kubernetes">ARM64 平台基于 openEuler + iSula 环境部署 Kubernetes</a></li><li><a href=https://atbug.com/enhance-dubbo-service-governance-with-flomesh/ class=nav-link title="使用 Flomesh 进行 Dubbo 服务治理">使用 Flomesh 进行 Dubbo 服务治理</a></li><li><a href=https://atbug.com/enhance-springcloud-service-governance-with-flomesh/ class=nav-link title="使用 Flomesh 强化 Spring Cloud 服务治理">使用 Flomesh 强化 Spring Cloud 服务治理</a></li><li><a href=https://atbug.com/a-framework-for-open-source-evaluation/ class=nav-link title=开源评估框架>开源评估框架</a></li><li><a href=https://atbug.com/2021-xinjiang-trip/ class=nav-link title="游记 - 2021 北疆之行">游记 - 2021 北疆之行</a></li></ul><div><h2 class="mt-4 taxonomy" id=categories-section>分类</h2><nav class=tags_nav><a href=https://atbug.com/categories/%E7%AC%94%E8%AE%B0/ class="post_tag button button_translucent" title=笔记>笔记
<span class=button_tally>48</span></a>
<a href=https://atbug.com/categories/%E5%AD%A6%E4%B9%A0/ class="post_tag button button_translucent" title=学习>学习
<span class=button_tally>40</span></a>
<a href=https://atbug.com/categories/%E7%BF%BB%E8%AF%91/ class="post_tag button button_translucent" title=翻译>翻译
<span class=button_tally>10</span></a>
<a href=https://atbug.com/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/ class="post_tag button button_translucent" title=源码解析>源码解析
<span class=button_tally>5</span></a>
<a href=https://atbug.com/categories/quickstart/ class="post_tag button button_translucent" title=quickstart>QUICKSTART
<span class=button_tally>4</span></a>
<a href=https://atbug.com/categories/devops/ class="post_tag button button_translucent" title=devops>DEVOPS
<span class=button_tally>2</span></a>
<a href=https://atbug.com/categories/%E5%B7%A5%E5%85%B7/ class="post_tag button button_translucent" title=工具>工具
<span class=button_tally>2</span></a>
<a href=https://atbug.com/categories/%E8%BD%AF%E4%BB%B6/ class="post_tag button button_translucent" title=软件>软件
<span class=button_tally>2</span></a>
<a href=https://atbug.com/categories/envoy/ class="post_tag button button_translucent" title=envoy>ENVOY
<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/kubernetes/ class="post_tag button button_translucent" title=kubernetes>KUBERNETES
<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/serverless/ class="post_tag button button_translucent" title=serverless>SERVERLESS
<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E5%AE%B9%E5%99%A8/ class="post_tag button button_translucent" title=容器>容器
<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class="post_tag button button_translucent" title=微服务>微服务
<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%8A%98%E8%85%BE/ class="post_tag button button_translucent" title=折腾>折腾
<span class=button_tally>1</span></a><br><div class="post_tags_toggle button">所有分类</div><div class=post_tags><div class=tags_list><a href=https://atbug.com/categories/devops/ class="post_tag button button_translucent" data-position=2 title=devops>DEVOPS<span class=button_tally>2</span></a>
<a href=https://atbug.com/categories/envoy/ class="post_tag button button_translucent" data-position=1 title=envoy>ENVOY<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/kubernetes/ class="post_tag button button_translucent" data-position=1 title=kubernetes>KUBERNETES<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/quickstart/ class="post_tag button button_translucent" data-position=4 title=quickstart>QUICKSTART<span class=button_tally>4</span></a>
<a href=https://atbug.com/categories/serverless/ class="post_tag button button_translucent" data-position=1 title=serverless>SERVERLESS<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E5%AD%A6%E4%B9%A0/ class="post_tag button button_translucent" data-position=40 title=学习>学习<span class=button_tally>40</span></a>
<a href=https://atbug.com/categories/%E5%AE%B9%E5%99%A8/ class="post_tag button button_translucent" data-position=1 title=容器>容器<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E5%B7%A5%E5%85%B7/ class="post_tag button button_translucent" data-position=2 title=工具>工具<span class=button_tally>2</span></a>
<a href=https://atbug.com/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class="post_tag button button_translucent" data-position=1 title=微服务>微服务<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%8A%98%E8%85%BE/ class="post_tag button button_translucent" data-position=1 title=折腾>折腾<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%97%85%E8%A1%8C/ class="post_tag button button_translucent" data-position=1 title=旅行>旅行<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%B5%8B%E8%AF%95/ class="post_tag button button_translucent" data-position=1 title=测试>测试<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%BA%90%E7%A0%81/ class="post_tag button button_translucent" data-position=1 title=源码>源码<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/ class="post_tag button button_translucent" data-position=1 title=源码分析>源码分析<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/ class="post_tag button button_translucent" data-position=5 title=源码解析>源码解析<span class=button_tally>5</span></a>
<a href=https://atbug.com/categories/%E7%AC%94%E8%AE%B0/ class="post_tag button button_translucent" data-position=48 title=笔记>笔记<span class=button_tally>48</span></a>
<a href=https://atbug.com/categories/%E7%BD%91%E5%85%B3/ class="post_tag button button_translucent" data-position=1 title=网关>网关<span class=button_tally>1</span></a>
<a href=https://atbug.com/categories/%E7%BF%BB%E8%AF%91/ class="post_tag button button_translucent" data-position=10 title=翻译>翻译<span class=button_tally>10</span></a>
<a href=https://atbug.com/categories/%E8%BD%AF%E4%BB%B6/ class="post_tag button button_translucent" data-position=2 title=软件>软件<span class=button_tally>2</span></a><div class=tags_sort><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span></div><span class=tags_hide><svg class="icon"><use xlink:href="#closeme"/></svg></span></div></div></nav></div><div><h2 class="mt-4 taxonomy" id=tags-section>标签</h2><nav class=tags_nav><a href=https://atbug.com/tags/java/ class="post_tag button button_translucent" title=java>JAVA
<span class=button_tally>25</span></a>
<a href=https://atbug.com/tags/kubernetes/ class="post_tag button button_translucent" title=kubernetes>KUBERNETES
<span class=button_tally>24</span></a>
<a href=https://atbug.com/tags/kafka/ class="post_tag button button_translucent" title=kafka>KAFKA
<span class=button_tally>9</span></a>
<a href=https://atbug.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/ class="post_tag button button_translucent" title=云原生>云原生
<span class=button_tally>9</span></a>
<a href=https://atbug.com/tags/go/ class="post_tag button button_translucent" title=go>GO
<span class=button_tally>8</span></a>
<a href=https://atbug.com/tags/tekton/ class="post_tag button button_translucent" title=tekton>TEKTON
<span class=button_tally>8</span></a>
<a href=https://atbug.com/tags/spring-cloud/ class="post_tag button button_translucent" title=spring-cloud>SPRING-CLOUD
<span class=button_tally>7</span></a>
<a href=https://atbug.com/tags/cicd/ class="post_tag button button_translucent" title=cicd>CICD
<span class=button_tally>6</span></a>
<a href=https://atbug.com/tags/docker/ class="post_tag button button_translucent" title=docker>DOCKER
<span class=button_tally>6</span></a>
<a href=https://atbug.com/tags/spring/ class="post_tag button button_translucent" title=spring>SPRING
<span class=button_tally>5</span></a>
<a href=https://atbug.com/tags/istio/ class="post_tag button button_translucent" title=istio>ISTIO
<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/jenkins/ class="post_tag button button_translucent" title=jenkins>JENKINS
<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/netflix/ class="post_tag button button_translucent" title=netflix>NETFLIX
<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/opa/ class="post_tag button button_translucent" title=opa>OPA
<span class=button_tally>4</span></a><br><div class="post_tags_toggle button">所有标签</div><div class=post_tags><div class=tags_list><a href=https://atbug.com/tags/alpine/ class="post_tag button button_translucent" data-position=1 title=alpine>ALPINE<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/apache-camel/ class="post_tag button button_translucent" data-position=1 title=apache-camel>APACHE-CAMEL<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/argo/ class="post_tag button button_translucent" data-position=1 title=argo>ARGO<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/benchmark/ class="post_tag button button_translucent" data-position=2 title=benchmark>BENCHMARK<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/c3p0/ class="post_tag button button_translucent" data-position=1 title=c3p0>C3P0<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/cas/ class="post_tag button button_translucent" data-position=1 title=cas>CAS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/cassandra/ class="post_tag button button_translucent" data-position=1 title=cassandra>CASSANDRA<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/centos/ class="post_tag button button_translucent" data-position=1 title=centos>CENTOS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/chrome/ class="post_tag button button_translucent" data-position=1 title=chrome>CHROME<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/ci/cd/ class="post_tag button button_translucent" data-position=1 title=ci/cd>CI/CD<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/cicd/ class="post_tag button button_translucent" data-position=6 title=cicd>CICD<span class=button_tally>6</span></a>
<a href=https://atbug.com/tags/cka/ class="post_tag button button_translucent" data-position=1 title=cka>CKA<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/dapr/ class="post_tag button button_translucent" data-position=1 title=dapr>DAPR<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/database/ class="post_tag button button_translucent" data-position=1 title=database>DATABASE<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/debug/ class="post_tag button button_translucent" data-position=1 title=debug>DEBUG<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/dekorate/ class="post_tag button button_translucent" data-position=1 title=dekorate>DEKORATE<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/develop/ class="post_tag button button_translucent" data-position=1 title=develop>DEVELOP<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/devops/ class="post_tag button button_translucent" data-position=1 title=devops>DEVOPS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/docekr/ class="post_tag button button_translucent" data-position=1 title=docekr>DOCEKR<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/docker/ class="post_tag button button_translucent" data-position=6 title=docker>DOCKER<span class=button_tally>6</span></a>
<a href=https://atbug.com/tags/dubbo/ class="post_tag button button_translucent" data-position=1 title=dubbo>DUBBO<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/elasticsearch/ class="post_tag button button_translucent" data-position=1 title=elasticsearch>ELASTICSEARCH<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/envoy/ class="post_tag button button_translucent" data-position=1 title=envoy>ENVOY<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/eureka/ class="post_tag button button_translucent" data-position=3 title=eureka>EUREKA<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/extension/ class="post_tag button button_translucent" data-position=1 title=extension>EXTENSION<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/flomesh/ class="post_tag button button_translucent" data-position=2 title=flomesh>FLOMESH<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/flume/ class="post_tag button button_translucent" data-position=1 title=flume>FLUME<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/git/ class="post_tag button button_translucent" data-position=1 title=git>GIT<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/go/ class="post_tag button button_translucent" data-position=8 title=go>GO<span class=button_tally>8</span></a>
<a href=https://atbug.com/tags/golang/ class="post_tag button button_translucent" data-position=1 title=golang>GOLANG<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/google/ class="post_tag button button_translucent" data-position=1 title=google>GOOGLE<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/greenplum/ class="post_tag button button_translucent" data-position=1 title=greenplum>GREENPLUM<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/groovy/ class="post_tag button button_translucent" data-position=1 title=groovy>GROOVY<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/haproxy/ class="post_tag button button_translucent" data-position=1 title=haproxy>HAPROXY<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/hpa/ class="post_tag button button_translucent" data-position=1 title=hpa>HPA<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/https/ class="post_tag button button_translucent" data-position=1 title=https>HTTPS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/hystrix/ class="post_tag button button_translucent" data-position=3 title=hystrix>HYSTRIX<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/istio/ class="post_tag button button_translucent" data-position=4 title=istio>ISTIO<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/java/ class="post_tag button button_translucent" data-position=25 title=java>JAVA<span class=button_tally>25</span></a>
<a href=https://atbug.com/tags/java8/ class="post_tag button button_translucent" data-position=1 title=java8>JAVA8<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/jenkins/ class="post_tag button button_translucent" data-position=4 title=jenkins>JENKINS<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/jib/ class="post_tag button button_translucent" data-position=2 title=jib>JIB<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/json/ class="post_tag button button_translucent" data-position=1 title=json>JSON<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/jvm/ class="post_tag button button_translucent" data-position=1 title=jvm>JVM<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/kafka/ class="post_tag button button_translucent" data-position=9 title=kafka>KAFKA<span class=button_tally>9</span></a>
<a href=https://atbug.com/tags/knative/ class="post_tag button button_translucent" data-position=2 title=knative>KNATIVE<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/kubelet/ class="post_tag button button_translucent" data-position=1 title=kubelet>KUBELET<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/kubenetes/ class="post_tag button button_translucent" data-position=1 title=kubenetes>KUBENETES<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/kubernetes/ class="post_tag button button_translucent" data-position=24 title=kubernetes>KUBERNETES<span class=button_tally>24</span></a>
<a href=https://atbug.com/tags/kuernetes/ class="post_tag button button_translucent" data-position=1 title=kuernetes>KUERNETES<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/kvm/ class="post_tag button button_translucent" data-position=1 title=kvm>KVM<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/linux/ class="post_tag button button_translucent" data-position=3 title=linux>LINUX<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/log4j/ class="post_tag button button_translucent" data-position=1 title=log4j>LOG4J<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/macos/ class="post_tag button button_translucent" data-position=1 title=macos>MACOS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/mesh/ class="post_tag button button_translucent" data-position=1 title=mesh>MESH<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/metaspace/ class="post_tag button button_translucent" data-position=1 title=metaspace>METASPACE<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/minishift/ class="post_tag button button_translucent" data-position=1 title=minishift>MINISHIFT<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/mybatis/ class="post_tag button button_translucent" data-position=1 title=mybatis>MYBATIS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/mysql/ class="post_tag button button_translucent" data-position=1 title=mysql>MYSQL<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/netflix/ class="post_tag button button_translucent" data-position=4 title=netflix>NETFLIX<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/nginx/ class="post_tag button button_translucent" data-position=2 title=nginx>NGINX<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/oci/ class="post_tag button button_translucent" data-position=1 title=oci>OCI<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/opa/ class="post_tag button button_translucent" data-position=4 title=opa>OPA<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/open-policy-agent/ class="post_tag button button_translucent" data-position=1 title=open-policy-agent>OPEN-POLICY-AGENT<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/openshift/ class="post_tag button button_translucent" data-position=3 title=openshift>OPENSHIFT<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/opensource/ class="post_tag button button_translucent" data-position=1 title=opensource>OPENSOURCE<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/ops/ class="post_tag button button_translucent" data-position=1 title=ops>OPS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/pipy/ class="post_tag button button_translucent" data-position=4 title=pipy>PIPY<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/plugin/ class="post_tag button button_translucent" data-position=1 title=plugin>PLUGIN<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/policy/ class="post_tag button button_translucent" data-position=1 title=policy>POLICY<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/prometheus/ class="post_tag button button_translucent" data-position=1 title=prometheus>PROMETHEUS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/quarkus/ class="post_tag button button_translucent" data-position=4 title=quarkus>QUARKUS<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/rabbitmq/ class="post_tag button button_translucent" data-position=1 title=rabbitmq>RABBITMQ<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/raft/ class="post_tag button button_translucent" data-position=1 title=raft>RAFT<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/redis/ class="post_tag button button_translucent" data-position=2 title=redis>REDIS<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/reids/ class="post_tag button button_translucent" data-position=1 title=reids>REIDS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/ribbon/ class="post_tag button button_translucent" data-position=2 title=ribbon>RIBBON<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/scala/ class="post_tag button button_translucent" data-position=2 title=scala>SCALA<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/serializer/ class="post_tag button button_translucent" data-position=1 title=serializer>SERIALIZER<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/serverless/ class="post_tag button button_translucent" data-position=1 title=serverless>SERVERLESS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/service-mesh/ class="post_tag button button_translucent" data-position=2 title=service-mesh>SERVICE-MESH<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/skaffold/ class="post_tag button button_translucent" data-position=1 title=skaffold>SKAFFOLD<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/slf4j/ class="post_tag button button_translucent" data-position=1 title=slf4j>SLF4J<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/spring/ class="post_tag button button_translucent" data-position=5 title=spring>SPRING<span class=button_tally>5</span></a>
<a href=https://atbug.com/tags/spring-boot/ class="post_tag button button_translucent" data-position=3 title=spring-boot>SPRING-BOOT<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/spring-cloud/ class="post_tag button button_translucent" data-position=7 title=spring-cloud>SPRING-CLOUD<span class=button_tally>7</span></a>
<a href=https://atbug.com/tags/springcloud/ class="post_tag button button_translucent" data-position=1 title=springcloud>SPRINGCLOUD<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/ssl/ class="post_tag button button_translucent" data-position=1 title=ssl>SSL<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/tekton/ class="post_tag button button_translucent" data-position=8 title=tekton>TEKTON<span class=button_tally>8</span></a>
<a href=https://atbug.com/tags/tomcat/ class="post_tag button button_translucent" data-position=1 title=tomcat>TOMCAT<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/tools/ class="post_tag button button_translucent" data-position=1 title=tools>TOOLS<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/troubleshooting/ class="post_tag button button_translucent" data-position=1 title=troubleshooting>TROUBLESHOOTING<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/zuul/ class="post_tag button button_translucent" data-position=3 title=zuul>ZUUL<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/%E4%B8%80%E8%87%B4%E6%80%A7/ class="post_tag button button_translucent" data-position=1 title=一致性>一致性<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E4%BA%91%E5%8E%9F%E7%94%9F/ class="post_tag button button_translucent" data-position=9 title=云原生>云原生<span class=button_tally>9</span></a>
<a href=https://atbug.com/tags/%E5%88%86%E5%B8%83%E5%BC%8F/ class="post_tag button button_translucent" data-position=1 title=分布式>分布式<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E5%91%8A%E8%AD%A6/ class="post_tag button button_translucent" data-position=1 title=告警>告警<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/ class="post_tag button button_translucent" data-position=1 title=多线程>多线程<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E5%AD%A6%E4%B9%A0/ class="post_tag button button_translucent" data-position=1 title=学习>学习<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E5%AE%89%E5%85%A8/ class="post_tag button button_translucent" data-position=1 title=安全>安全<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E5%B7%A5%E5%85%B7/ class="post_tag button button_translucent" data-position=1 title=工具>工具<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/ class="post_tag button button_translucent" data-position=1 title=微服务>微服务<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E6%95%B0%E6%8D%AE%E5%B9%B3%E9%9D%A2/ class="post_tag button button_translucent" data-position=1 title=数据平面>数据平面<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E6%96%AD%E8%B7%AF%E5%99%A8/ class="post_tag button button_translucent" data-position=1 title=断路器>断路器<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/ class="post_tag button button_translucent" data-position=1 title=最佳实践>最佳实践<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E6%9C%8D%E5%8A%A1%E7%BD%91%E6%A0%BC/ class="post_tag button button_translucent" data-position=1 title=服务网格>服务网格<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E6%9E%B6%E6%9E%84/ class="post_tag button button_translucent" data-position=4 title=架构>架构<span class=button_tally>4</span></a>
<a href=https://atbug.com/tags/%E6%BA%90%E7%A0%81/ class="post_tag button button_translucent" data-position=2 title=源码>源码<span class=button_tally>2</span></a>
<a href=https://atbug.com/tags/%E7%AE%97%E6%B3%95/ class="post_tag button button_translucent" data-position=1 title=算法>算法<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E7%BA%BF%E7%A8%8B/ class="post_tag button button_translucent" data-position=1 title=线程>线程<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E7%BD%91%E5%85%B3/ class="post_tag button button_translucent" data-position=3 title=网关>网关<span class=button_tally>3</span></a>
<a href=https://atbug.com/tags/%E7%BF%BB%E8%AF%91/ class="post_tag button button_translucent" data-position=1 title=翻译>翻译<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1/ class="post_tag button button_translucent" data-position=1 title=负载均衡>负载均衡<span class=button_tally>1</span></a>
<a href=https://atbug.com/tags/%E9%9A%8F%E7%AC%94/ class="post_tag button button_translucent" data-position=1 title=随笔>随笔<span class=button_tally>1</span></a><div class=tags_sort><span title="sort alphabetically">[A~Z]</span><span title="sort by count">[0~9]</span></div><span class=tags_hide><svg class="icon"><use xlink:href="#closeme"/></svg></span></div></div></nav></div></section></aside></div></main><svg width="0" height="0" class="hidden"><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="facebook"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h151V331h-60v-90h60v-61c0-49.629 40.371-90 90-90h91v90h-91v61h91l-15 90h-76v181h121c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 18.001 18.001" id="twitter"><path d="M15.891 4.013c.808-.496 1.343-1.173 1.605-2.034a8.68 8.68.0 01-2.351.861c-.703-.756-1.593-1.14-2.66-1.14-1.043.0-1.924.366-2.643 1.078A3.56 3.56.0 008.766 5.383c0 .309.039.585.117.819-3.076-.105-5.622-1.381-7.628-3.837-.34.601-.51 1.213-.51 1.846.0 1.301.549 2.332 1.645 3.089-.625-.053-1.176-.211-1.645-.47.0.929.273 1.705.82 2.388a3.623 3.623.0 002.115 1.291c-.312.08-.641.118-.979.118-.312.0-.533-.026-.664-.083.23.757.664 1.371 1.291 1.841a3.652 3.652.0 002.152.743C4.148 14.173 2.625 14.69.902 14.69c-.422.0-.721-.006-.902-.038 1.697 1.102 3.586 1.649 5.676 1.649 2.139.0 4.029-.542 5.674-1.626 1.645-1.078 2.859-2.408 3.639-3.974a10.77 10.77.0 001.172-4.892v-.468a7.788 7.788.0 001.84-1.921 8.142 8.142.0 01-2.11.593z"/></symbol><symbol aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="mail"><path d="M502.3 190.8c3.9-3.1 9.7-.2 9.7 4.7V4e2c0 26.5-21.5 48-48 48H48c-26.5.0-48-21.5-48-48V195.6c0-5 5.7-7.8 9.7-4.7 22.4 17.4 52.1 39.5 154.1 113.6 21.1 15.4 56.7 47.8 92.2 47.6 35.7.3 72-32.8 92.3-47.6 102-74.1 131.6-96.3 154-113.7zM256 320c23.2.4 56.6-29.2 73.4-41.4 132.7-96.3 142.8-104.7 173.4-128.7 5.8-4.5 9.2-11.5 9.2-18.9v-19c0-26.5-21.5-48-48-48H48C21.5 64 0 85.5.0 112v19c0 7.4 3.4 14.3 9.2 18.9 30.6 23.9 40.7 32.4 173.4 128.7 16.8 12.2 50.2 41.8 73.4 41.4z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="calendar"><path d="M452 40h-24V0h-40v40H124V0H84v40H60C26.916 40 0 66.916.0 1e2v352c0 33.084 26.916 60 60 60h392c33.084.0 60-26.916 60-60V1e2c0-33.084-26.916-60-60-60zm20 412c0 11.028-8.972 20-20 20H60c-11.028.0-20-8.972-20-20V188h432v264zm0-304H40v-48c0-11.028 8.972-20 20-20h24v40h40V80h264v40h40V80h24c11.028.0 20 8.972 20 20v48z"/><path d="M76 230h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 310h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zM76 390h40v40H76zm80 0h40v40h-40zm80 0h40v40h-40zm80 0h40v40h-40zm80-80h40v40h-40z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="github"><path d="M255.968 5.329C114.624 5.329.0 120.401.0 262.353c0 113.536 73.344 209.856 175.104 243.872 12.8 2.368 17.472-5.568 17.472-12.384.0-6.112-.224-22.272-.352-43.712-71.2 15.52-86.24-34.464-86.24-34.464-11.616-29.696-28.416-37.6-28.416-37.6-23.264-15.936 1.728-15.616 1.728-15.616 25.696 1.824 39.2 26.496 39.2 26.496 22.848 39.264 59.936 27.936 74.528 21.344 2.304-16.608 8.928-27.936 16.256-34.368-56.832-6.496-116.608-28.544-116.608-127.008.0-28.064 9.984-51.008 26.368-68.992-2.656-6.496-11.424-32.64 2.496-68 0 0 21.504-6.912 70.4 26.336 20.416-5.696 42.304-8.544 64.096-8.64 21.728.128 43.648 2.944 64.096 8.672 48.864-33.248 70.336-26.336 70.336-26.336 13.952 35.392 5.184 61.504 2.56 68 16.416 17.984 26.304 40.928 26.304 68.992.0 98.72-59.84 120.448-116.864 126.816 9.184 7.936 17.376 23.616 17.376 47.584.0 34.368-.32 62.08-.32 70.496.0 6.88 4.608 14.88 17.6 12.352C438.72 472.145 512 375.857 512 262.353 512 120.401 397.376 5.329 255.968 5.329z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 212 212" id="gitlab"><path d="M12.3 74.7h54L43.3 3c-1-3.6-6.4-3.6-7.6.0L12.3 74.8z"/><path d="M12.3 74.7.5 111c-1 3.2.0 6.8 3 8.8l101.6 74-92.5-119z"/><path d="M105 193.7l-38.6-119h-54l92.7 119z"/><path d="M105 193.7l38.7-119H66.4l38.7 119z"/><path d="M105 193.7l38.7-119H198l-93 119z"/><path d="M198 74.7l11.6 36.2c1 3 0 6.6-3 8.6l-101.5 74 93-119z"/><path d="M198 74.7h-54.3L167 3c1.2-3.6 6.4-3.6 7.6.0L198 74.8z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="rss"><circle cx="3.429" cy="20.571" r="3.429"/><path d="M11.429 24h4.57C15.999 15.179 8.821 8.001.0 8v4.572c6.302.001 11.429 5.126 11.429 11.428z"/><path d="M24 24C24 10.766 13.234.0.0.0v4.571c10.714.0 19.43 8.714 19.43 19.429z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="linkedin"><path d="M437 0H75C33.648.0.0 33.648.0 75v362c0 41.352 33.648 75 75 75h362c41.352.0 75-33.648 75-75V75c0-41.352-33.648-75-75-75zM181 406h-60V196h60zm0-240h-60v-60h60zm210 240h-60V286c0-16.54-13.46-30-30-30s-30 13.46-30 30v120h-60V196h60v11.309C286.719 202.422 296.93 196 316 196c40.691.043 75 36.547 75 79.688zm0 0"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 612 612" id="arrow"><path d="M604.501 440.509 325.398 134.956c-5.331-5.357-12.423-7.627-19.386-7.27-6.989-.357-14.056 1.913-19.387 7.27L7.499 440.509c-9.999 10.024-9.999 26.298.0 36.323s26.223 10.024 36.222.0l262.293-287.164L568.28 476.832c9.999 10.024 26.222 10.024 36.221.0 9.999-10.023 9.999-26.298.0-36.323z"/></symbol><symbol viewBox="0 0 512 512" xmlns="http://www.w3.org/2000/svg" id="carly"><path d="M504.971 239.029 448 182.059V84c0-46.317-37.682-84-84-84h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c19.851.0 36 16.149 36 36v108c0 6.365 2.529 12.47 7.029 16.971L454.059 256l-47.029 47.029A24.002 24.002.0 004e2 320v108c0 19.851-16.149 36-36 36h-44c-13.255.0-24 10.745-24 24s10.745 24 24 24h44c46.318.0 84-37.683 84-84v-98.059l56.971-56.971c9.372-9.372 9.372-24.568.0-33.941zM112 192V84c0-19.851 16.149-36 36-36h44c13.255.0 24-10.745 24-24S205.255.0 192 0h-44c-46.318.0-84 37.683-84 84v98.059l-56.971 56.97c-9.373 9.373-9.373 24.568.0 33.941L64 329.941V428c0 46.317 37.682 84 84 84h44c13.255.0 24-10.745 24-24s-10.745-24-24-24h-44c-19.851.0-36-16.149-36-36V320c0-6.365-2.529-12.47-7.029-16.971L57.941 256l47.029-47.029A24.002 24.002.0 00112 192z"/></symbol><symbol viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" id="copy"><path d="M23 2.75A2.75 2.75.0 0020.25.0H8.75A2.75 2.75.0 006 2.75v13.5A2.75 2.75.0 008.75 19h11.5A2.75 2.75.0 0023 16.25zM18.25 14.5h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5zm0-3h-7.5a.75.75.0 010-1.5h7.5a.75.75.0 010 1.5z"/><path d="M8.75 20.5A4.255 4.255.0 014.5 16.25V2.75c0-.086.02-.166.025-.25H3.75A2.752 2.752.0 001 5.25v16A2.752 2.752.0 003.75 24h12a2.752 2.752.0 002.75-2.75v-.75z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512.001 512.001" id="closeme"><path d="M284.286 256.002 506.143 34.144c7.811-7.811 7.811-20.475.0-28.285-7.811-7.81-20.475-7.811-28.285.0L256 227.717 34.143 5.859c-7.811-7.811-20.475-7.811-28.285.0-7.81 7.811-7.811 20.475.0 28.285l221.857 221.857L5.858 477.859c-7.811 7.811-7.811 20.475.0 28.285a19.938 19.938.0 0014.143 5.857 19.94 19.94.0 0014.143-5.857L256 284.287l221.857 221.857c3.905 3.905 9.024 5.857 14.143 5.857s10.237-1.952 14.143-5.857c7.811-7.811 7.811-20.475.0-28.285L284.286 256.002z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" id="open-menu"><path d="M492 236H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0-160H20C8.954 76 0 84.954.0 96s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20zm0 320H20c-11.046.0-20 8.954-20 20s8.954 20 20 20h472c11.046.0 20-8.954 20-20s-8.954-20-20-20z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="instagram"><path d="M12 2.163c3.204.0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849.0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204.0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849.0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zM12 0C8.741.0 8.333.014 7.053.072c-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948s.014 3.668.072 4.948c.2 4.358 2.618 6.78 6.98 6.98C8.333 23.986 8.741 24 12 24s3.668-.014 4.948-.072c4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948s-.014-3.667-.072-4.947c-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403.0-6.162 2.759-6.162 6.162S8.597 18.163 12 18.163s6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zM12 16c-2.209.0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796.0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795.0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="youtube"><path d="M19.615 3.184c-3.604-.246-11.631-.245-15.23.0-3.897.266-4.356 2.62-4.385 8.816.029 6.185.484 8.549 4.385 8.816 3.6.245 11.626.246 15.23.0C23.512 20.55 23.971 18.196 24 12c-.029-6.185-.484-8.549-4.385-8.816zM9 16V8l8 3.993L9 16z"/></symbol><symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="stackoverflow"><path d="M21 27v-8h3v11H0V19h3v8h18z"/><path d="M17.1.2 15 1.8l7.9 10.6 2.1-1.6L17.1.2zm3.7 14.7L10.6 6.4l1.7-2 10.2 8.5-1.7 2zM7.2 12.3l12 5.6 1.1-2.4-12-5.6-1.1 2.4zm-1.8 6.8 13.56 1.96.17-2.38-13.26-2.55-.47 2.97zM19 25H5v-3h14v3z"/></symbol></svg><footer class=footer><div class="footer_inner wrap pale"><img src=https://atbug.com/icons/apple-touch-icon.png class="icon icon_2 transparent" alt=乱世浮生><p>Copyright&nbsp;2015 -&nbsp;<span class=year></span>&nbsp;乱世浮生. All Rights Reserved</p><a class=to_top href=#documentTop><svg class="icon"><use xlink:href="#arrow"/></svg></a></div></footer><script type=text/javascript src=https://atbug.com/js/bundle.min.90cbe84f27859868a1c2f20af76ac2cc69c32540555dbbdae845870af41ba688e06385e7e720680cc34e65b9fdd5381585b444e33c735f35d05e6c5dc7d7bdc0.js integrity="sha512-kMvoTyeFmGihwvIK92rCzGnDJUBVXbva6EWHCvQbpojgY4Xn5yBoDMNOZbn91TgVhbRE4zxzXzXQXmxdx9e9wA==" crossorigin=anonymous></script></body></html>