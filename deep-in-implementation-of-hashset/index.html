<!DOCTYPE html>
<html lang="zh-cn" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>深入剖析HashSet和HashMap实现 - 乱世浮生</title>
  <meta name="description" content="HashSet是一个包含非重复元素的集合，如何实现的，要从底层实现代码看起。 背景 首先非重复元素如何定义，看Set的描述： More formally, sets contain no pair of elements e1 and">
  <meta name="author" content="Addo Zhang"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "乱世浮生",
    
    "url": "https:\/\/atbug.com\/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https:\/\/atbug.com\/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https:\/\/atbug.com\/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https:\/\/atbug.com\/deep-in-implementation-of-hashset\/",
          "name": "深入剖析 hash set和 hash map实现"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "Addo Zhang"
  },
  "headline": "深入剖析HashSet和HashMap实现",
  "description" : "HashSet是一个包含非重复元素的集合，如何实现的，要从底层实现代码看起。 背景 首先非重复元素如何定义，看Set的描述： More formally, sets contain no pair of elements e1 and",
  "inLanguage" : "zh-cn",
  "wordCount":  2617 ,
  "datePublished" : "2016-07-11T14:57:16",
  "dateModified" : "2016-07-11T14:57:16",
  "image" : "https:\/\/atbug.com\/",
  "keywords" : [ "Java" ],
  "mainEntityOfPage" : "https:\/\/atbug.com\/deep-in-implementation-of-hashset\/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https:\/\/atbug.com\/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https:\/\/atbug.com\/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="深入剖析HashSet和HashMap实现" />
<meta property="og:description" content="HashSet是一个包含非重复元素的集合，如何实现的，要从底层实现代码看起。 背景 首先非重复元素如何定义，看Set的描述： More formally, sets contain no pair of elements e1 and">
<meta property="og:url" content="https://atbug.com/deep-in-implementation-of-hashset/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="乱世浮生" />

  <meta name="twitter:title" content="深入剖析HashSet和HashMap实现" />
  <meta name="twitter:description" content="HashSet是一个包含非重复元素的集合，如何实现的，要从底层实现代码看起。 背景 首先非重复元素如何定义，看Set的描述： More formally, sets contain no pair of elements e1 and">
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.57.2" />
  <link rel="alternate" href="https://atbug.com/index.xml" type="application/rss+xml" title="乱世浮生"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous"><link rel="stylesheet" href="https://atbug.com/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="https://atbug.com/css/syntax.css" /><link rel="stylesheet" href="https://atbug.com/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">


<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-47966140-1', 'auto');
	ga('set', 'anonymizeIp', true);
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">切换导航</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://atbug.com/">乱世浮生</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Home" href="../">Home</a>
            </li>
          
        
          
            <li>
              <a title="Archives" href="../post/">Archives</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="../tags/">Tags</a>
            </li>
          
        
          
            <li>
              <a title="Categories" href="../categories/">Categories</a>
            </li>
          
        
          
            <li>
              <a title="About" href="../about/">About</a>
            </li>
          
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>深入剖析HashSet和HashMap实现</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;发表于 July 11, 2016
  
  
  
  
    
      &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;Addo Zhang
    
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>HashSet是一个包含非重复元素的集合，如何实现的，要从底层实现代码看起。</p>

<h4 id="背景">背景</h4>

<p>首先非重复元素如何定义，看Set的描述：</p>

<blockquote>
<p>More formally, sets contain no pair of elements e1 and e2 such that e1.equals(e2), and at most one null element.</p>

<p>Set不会找到两个元素，并且两个元素满足e1.equals(e2)为true；并且最多只有一个null元素。</p>
</blockquote>

<p>如果没有重写equals方法，查看Object类中equal方法的实现，==比较的其实是两个对象在内存中的地址。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">boolean</span> <span class="n">equals</span><span class="p">(</span><span class="n">Object</span> <span class="nf">obj</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="p">(</span><span class="k">this</span> <span class="o">==</span> <span class="n">obj</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<p>说起equals方法，就不得不说hashCode方法了。Java中对于hashCode有个常规协定</p>

<blockquote>
<p>The general contract of hashCode is:</p>

<ul>
<li><p>Whenever it is invoked on the same object more than once during an execution of a Java application, the hashCode method must consistently return the same integer, provided no information used in equals comparisons on the object is modified. This integer need not remain consistent from one execution of an application to another execution of the same application.</p></li>

<li><p>If two objects are equal according to the equals(Object) method, then calling the hashCode method on each of the two objects must produce the same integer result.</p></li>

<li><p>It is not required that if two objects are unequal according to the equals(java.lang.Object) method, then calling the hashCode method on each of the two objects must produce distinct integer results. However, the programmer should be aware that producing distinct integer results for unequal objects may improve the performance of hash tables.</p></li>

<li><p>程序执行期间，在同一个对象上执行多次hashCode方法，都返回相同的整数，前提是equals比较中所使用的字段没有被修改。跨应用中的hashCode方法调用返回的整数不要求相同。</p></li>

<li><p>如果两个对象根据equals方法比较相同，那hashCode返回的整数也必须相同。</p></li>

<li><p>如果两个对象equals方法比较不相同，调用hashCode返回的整数不需要不同。但是程序员应该知道为不相等的对象生成不同的整数可以提高哈希表的性能。</p></li>
</ul>
</blockquote>

<h4 id="hashset的底层实现">HashSet的底层实现</h4>

<p>HashSet的底层是通过HashMap实现的，将元素作为map的key以达到去重的目的，value使用的是同一个虚拟的Object实例。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">private</span> <span class="nf">transient</span> <span class="n">HashMap</span><span class="o">&lt;</span><span class="n">E</span><span class="p">,</span><span class="n">Object</span><span class="o">&gt;</span> <span class="nf">map</span><span class="p">;</span>

<span class="c1">// Dummy value to associate with an Object in the backing Map
</span><span class="c1"></span><span class="kd">private</span> <span class="nf">static</span> <span class="kd">final</span> <span class="nf">Object</span> <span class="n">PRESENT</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Object</span><span class="p">();</span>

<span class="kd">public</span> <span class="nf">boolean</span> <span class="n">add</span><span class="p">(</span><span class="n">E</span> <span class="nf">e</span><span class="p">)</span> <span class="p">{</span>
   <span class="k">return</span> <span class="n">map</span><span class="p">.</span><span class="na">put</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="n">PRESENT</span><span class="p">)</span><span class="o">==</span><span class="kc">null</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<h4 id="hashmap的底层实现">HashMap的底层实现</h4>

<p>{% asset_img hashmap-structure.jpg %}</p>

<p>到最后我们要看HashMap的实现了，简单说就是一个<strong>数组</strong>+<strong>链表</strong>的结合。</p>

<ul>
<li>默认初始容量16</li>
<li>默认负荷系数0.75</li>
<li>Entry数组</li>
<li>大小</li>
<li>阈值：初始值等于初始容量</li>

<li><p>负荷系数</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="nf">final</span> <span class="kt">int</span> <span class="nf">DEFAULT_INITIAL_CAPACITY</span> <span class="o">=</span> <span class="n">1</span> <span class="o">&lt;&lt;</span> <span class="n">4</span><span class="p">;</span>
<span class="kd">static</span> <span class="nf">final</span> <span class="kt">float</span> <span class="nf">DEFAULT_LOAD_FACTOR</span> <span class="o">=</span> <span class="n">0</span><span class="p">.</span><span class="na">75f</span><span class="p">;</span>
<span class="kd">static</span> <span class="nf">final</span> <span class="n">Entry</span><span class="o">&lt;?</span><span class="p">,</span><span class="o">?&gt;</span><span class="p">[]</span> <span class="n">EMPTY_TABLE</span> <span class="o">=</span> <span class="p">{};</span>
<span class="kd">transient</span> <span class="nf">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="p">[]</span> <span class="nf">table</span> <span class="o">=</span> <span class="p">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="p">[])</span> <span class="n">EMPTY_TABLE</span><span class="p">;</span>
<span class="kd">transient</span> <span class="nf">int</span> <span class="n">size</span><span class="p">;</span>
<span class="kt">int</span> <span class="nf">threshold</span><span class="p">;</span>
<span class="kd">final</span> <span class="nf">float</span> <span class="n">loadFactor</span><span class="p">;</span></code></pre></div></li>
</ul>

<h5 id="entry元素">Entry元素</h5>

<p>Entry是链表的结果，key为Map中的key，value为Map中的value，hash为key的hash结果，next为下一个元素。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="nf">class</span> <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">implements</span> <span class="n">Map</span><span class="p">.</span><span class="na">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="kd">final</span> <span class="nf">K</span> <span class="n">key</span><span class="p">;</span>
    <span class="n">V</span> <span class="nf">value</span><span class="p">;</span>
    <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">next</span><span class="p">;</span>
    <span class="kt">int</span> <span class="nf">hash</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<h5 id="添加元素">添加元素</h5>

<ul>
<li>如果数组为空（即map初始化后第一次添加元素）扩充table</li>
<li>如果key为null，则调用putForNullKey方法，null位于table的下标0处</li>
<li>算出key的hash值</li>
<li>通过hash值算出元素在table中的下标值

<ul>
<li>如果该位置元素不为空，然后需要比较元素的hash值和上面算出的hash值是否相等，同时元素的key对象和要出入的key是否为同一对象（相同的地址 ==比较为true）或者equals方法是否为true。如果满足条件，则更新该entry的value值；若不满足则遍历整个链表。</li>
<li>如果为空直接添加新的entry。</li>
</ul></li>
</ul>

<p><strong>JDK8此处有更新，见末尾</strong></p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">public</span> <span class="nf">V</span> <span class="n">put</span><span class="p">(</span><span class="n">K</span> <span class="nf">key</span><span class="p">,</span> <span class="n">V</span> <span class="nf">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">table</span> <span class="o">==</span> <span class="n">EMPTY_TABLE</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">inflateTable</span><span class="p">(</span><span class="n">threshold</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">key</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">putForNullKey</span><span class="p">(</span><span class="n">value</span><span class="p">);</span>
    <span class="kt">int</span> <span class="nf">hash</span> <span class="o">=</span> <span class="n">hash</span><span class="p">(</span><span class="n">key</span><span class="p">);</span>
    <span class="kt">int</span> <span class="nf">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">e</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="n">i</span><span class="p">];</span> <span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">;</span> <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">next</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Object</span> <span class="nf">k</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span> <span class="p">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span> <span class="p">{</span>
            <span class="n">V</span> <span class="nf">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">value</span><span class="p">;</span>
            <span class="n">e</span><span class="p">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
            <span class="n">e</span><span class="p">.</span><span class="na">recordAccess</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">oldValue</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="n">modCount</span><span class="o">++</span><span class="p">;</span>
    <span class="n">addEntry</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">i</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>
<h5 id="扩充table">扩充table</h5>

<p>对toSzie算出最小的2的幂值，用了Integer.highestOneBit((toSize -1) &lt;&lt; 1)。减一之后左移一位，然后取最高位值，其余为补0。</p>

<p>为什么数组长度必须为2的幂值，请继续看。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="cm">/**
</span><span class="cm"> * 扩充table
</span><span class="cm">**/</span>
<span class="kd">private</span> <span class="nf">void</span> <span class="n">inflateTable</span><span class="p">(</span><span class="kt">int</span> <span class="nf">toSize</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Find a power of 2 &gt;= toSize
</span><span class="c1"></span>    <span class="kt">int</span> <span class="nf">capacity</span> <span class="o">=</span> <span class="n">roundUpToPowerOf2</span><span class="p">(</span><span class="n">toSize</span><span class="p">);</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span> <span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">capacity</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="p">,</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">+</span> <span class="n">1</span><span class="p">);</span>
    <span class="n">table</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="p">[</span><span class="n">capacity</span><span class="p">];</span>
    <span class="n">initHashSeedAsNeeded</span><span class="p">(</span><span class="n">capacity</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<h5 id="计算hash值">计算hash值</h5>

<p>hashSeed值为0，将key的hashCode值做多次位移和异或运算</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="nf">int</span> <span class="n">hash</span><span class="p">(</span><span class="n">Object</span> <span class="nf">k</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="nf">h</span> <span class="o">=</span> <span class="n">hashSeed</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">0</span> <span class="o">!=</span> <span class="n">h</span> <span class="o">&amp;&amp;</span> <span class="n">k</span> <span class="nf">instanceof</span> <span class="n">String</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="n">sun</span><span class="p">.</span><span class="na">misc</span><span class="p">.</span><span class="na">Hashing</span><span class="p">.</span><span class="na">stringHash32</span><span class="p">((</span><span class="n">String</span><span class="p">)</span> <span class="n">k</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">h</span> <span class="o">^=</span> <span class="n">k</span><span class="p">.</span><span class="na">hashCode</span><span class="p">();</span>
    <span class="c1">// This function ensures that hashCodes that differ only by
</span><span class="c1"></span>    <span class="c1">// constant multiples at each bit position have a bounded
</span><span class="c1"></span>    <span class="c1">// number of collisions (approximately 8 at default load factor).
</span><span class="c1"></span>    <span class="n">h</span> <span class="o">^=</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">20</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">12</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">h</span> <span class="o">^</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">7</span><span class="p">)</span> <span class="o">^</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;&gt;&gt;</span> <span class="n">4</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<h5 id="计算元素位置">计算元素位置</h5>

<p>这里的逻辑很简单：将hash值跟数组长度-1做了按位与。</p>

<p>在进行查找的时候是通过key的hash值，如果我们将元素的位置分布得尽量均匀一些，尽量做到每个位置上只有一个元素，达到O(1)的查找。这种查找通过取余就可以做到，在Java中如何做到比较快的取余呢，答案是位与运算。</p>

<p>上面扩充数组的时候我们保证长度为2的幂值，那减一之后就是每位都是<strong>1</strong>。做位与运算就能保证低位不同的hash值会落在不同的位置上，降低冲突（碰撞），最大程度做到均匀分布，减少链表的出现（查找变成O(n)）。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">static</span> <span class="nf">int</span> <span class="n">indexFor</span><span class="p">(</span><span class="kt">int</span> <span class="nf">h</span><span class="p">,</span> <span class="kt">int</span> <span class="nf">length</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// assert Integer.bitCount(length) == 1 : &#34;length must be a non-zero power of 2&#34;;
</span><span class="c1"></span>    <span class="k">return</span> <span class="n">h</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">length</span><span class="o">-</span><span class="n">1</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<h5 id="添加entry">添加entry</h5>

<p>添加新的元素时要检查元素个数是否达到阈值，否则要做扩容处理，新table的容量为当前table长度的两倍。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">addEntry</span><span class="p">(</span><span class="kt">int</span> <span class="nf">hash</span><span class="p">,</span> <span class="n">K</span> <span class="nf">key</span><span class="p">,</span> <span class="n">V</span> <span class="nf">value</span><span class="p">,</span> <span class="kt">int</span> <span class="nf">bucketIndex</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">size</span> <span class="o">&gt;=</span> <span class="n">threshold</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">table</span><span class="p">[</span><span class="n">bucketIndex</span><span class="p">]))</span> <span class="p">{</span>
        <span class="n">resize</span><span class="p">(</span><span class="n">2</span> <span class="o">*</span> <span class="n">table</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
        <span class="n">hash</span> <span class="o">=</span> <span class="p">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">key</span><span class="p">)</span> <span class="o">?</span> <span class="n">hash</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">:</span> <span class="n">0</span><span class="p">;</span>
        <span class="n">bucketIndex</span> <span class="o">=</span> <span class="n">indexFor</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">table</span><span class="p">.</span><span class="na">length</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="n">createEntry</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">bucketIndex</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<h5 id="resize">resize</h5>

<p>新table的容量为当前table长度的两倍（table.length &gt;= size），将旧数据中的数据迁移到新的数组中，迁移的过程中要重新计算元素在新数组中的位置。网上很多地方提到这个操作rehash，但我觉得reindex反而更恰当一些。JDK中对rehash有额外的定义，就是<strong>initHashSeedAsNeeded</strong>。当新的容量&gt;=<strong>jdk.map.althashing.threshold</strong>的配置时，会重新计算key的hash值，即hash(e.key)。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">resize</span><span class="p">(</span><span class="kt">int</span> <span class="nf">newCapacity</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Entry</span><span class="p">[]</span> <span class="nf">oldTable</span> <span class="o">=</span> <span class="n">table</span><span class="p">;</span>
    <span class="kt">int</span> <span class="nf">oldCapacity</span> <span class="o">=</span> <span class="n">oldTable</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">oldCapacity</span> <span class="o">==</span> <span class="n">MAXIMUM_CAPACITY</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">Integer</span><span class="p">.</span><span class="na">MAX_VALUE</span><span class="p">;</span>
        <span class="k">return</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">Entry</span><span class="p">[]</span> <span class="nf">newTable</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Entry</span><span class="p">[</span><span class="n">newCapacity</span><span class="p">];</span>
    <span class="n">transfer</span><span class="p">(</span><span class="n">newTable</span><span class="p">,</span> <span class="n">initHashSeedAsNeeded</span><span class="p">(</span><span class="n">newCapacity</span><span class="p">));</span>
    <span class="n">table</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">;</span>
    <span class="n">threshold</span> <span class="o">=</span> <span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="n">Math</span><span class="p">.</span><span class="na">min</span><span class="p">(</span><span class="n">newCapacity</span> <span class="o">*</span> <span class="n">loadFactor</span><span class="p">,</span> <span class="n">MAXIMUM_CAPACITY</span> <span class="o">+</span> <span class="n">1</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>
<h5 id="reindex">reindex</h5>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kt">void</span> <span class="nf">transfer</span><span class="p">(</span><span class="n">Entry</span><span class="p">[]</span> <span class="nf">newTable</span><span class="p">,</span> <span class="kt">boolean</span> <span class="nf">rehash</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="nf">newCapacity</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">.</span><span class="na">length</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">e</span> <span class="o">:</span> <span class="n">table</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">while</span><span class="p">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Entry</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">next</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">next</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">rehash</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">e</span><span class="p">.</span><span class="na">hash</span> <span class="o">=</span> <span class="kc">null</span> <span class="o">==</span> <span class="n">e</span><span class="p">.</span><span class="na">key</span> <span class="o">?</span> <span class="n">0</span> <span class="o">:</span> <span class="n">hash</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">key</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="kt">int</span> <span class="nf">i</span> <span class="o">=</span> <span class="n">indexFor</span><span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">hash</span><span class="p">,</span> <span class="n">newCapacity</span><span class="p">);</span>
            <span class="n">e</span><span class="p">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newTable</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="n">newTable</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">next</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<hr />

<p>JDK8 update
添加元素的时候，如果发生哈希冲突，会遍历链表。加入链表的长度大于TREEIFY_THRESHOLD（默认为8），会将链表转成<strong>红黑树</strong>。</p>
<div class="highlight"><pre class="chroma"><code class="language-java" data-lang="java"><span class="kd">final</span> <span class="nf">V</span> <span class="n">putVal</span><span class="p">(</span><span class="kt">int</span> <span class="nf">hash</span><span class="p">,</span> <span class="n">K</span> <span class="nf">key</span><span class="p">,</span> <span class="n">V</span> <span class="nf">value</span><span class="p">,</span> <span class="kt">boolean</span> <span class="nf">onlyIfAbsent</span><span class="p">,</span>
               <span class="kt">boolean</span> <span class="nf">evict</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="p">[]</span> <span class="nf">tab</span><span class="p">;</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">p</span><span class="p">;</span> <span class="kt">int</span> <span class="nf">n</span><span class="p">,</span> <span class="n">i</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">tab</span> <span class="o">=</span> <span class="n">table</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">tab</span><span class="p">.</span><span class="na">length</span><span class="p">)</span> <span class="o">==</span> <span class="n">0</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">=</span> <span class="p">(</span><span class="n">tab</span> <span class="o">=</span> <span class="n">resize</span><span class="p">()).</span><span class="na">length</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">p</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="p">])</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
        <span class="n">tab</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
    <span class="k">else</span> <span class="p">{</span>
        <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">e</span><span class="p">;</span> <span class="n">K</span> <span class="nf">k</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">p</span><span class="p">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span>
            <span class="p">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="na">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">k</span><span class="p">))))</span>
            <span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">p</span> <span class="nf">instanceof</span> <span class="n">TreeNode</span><span class="p">)</span>
            <span class="n">e</span> <span class="o">=</span> <span class="p">((</span><span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="p">)</span><span class="n">p</span><span class="p">).</span><span class="na">putTreeVal</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">tab</span><span class="p">,</span> <span class="n">hash</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">);</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="nf">binCount</span> <span class="o">=</span> <span class="n">0</span><span class="p">;</span> <span class="p">;</span> <span class="o">++</span><span class="n">binCount</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="na">next</span><span class="p">)</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">p</span><span class="p">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">newNode</span><span class="p">(</span><span class="n">hash</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">binCount</span> <span class="o">&gt;=</span> <span class="n">TREEIFY_THRESHOLD</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span> <span class="c1">// -1 for 1st
</span><span class="c1"></span>                        <span class="n">treeifyBin</span><span class="p">(</span><span class="n">tab</span><span class="p">,</span> <span class="n">hash</span><span class="p">);</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="p">.</span><span class="na">hash</span> <span class="o">==</span> <span class="n">hash</span> <span class="o">&amp;&amp;</span>
                    <span class="p">((</span><span class="n">k</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">key</span><span class="p">)</span> <span class="o">==</span> <span class="n">key</span> <span class="o">||</span> <span class="p">(</span><span class="n">key</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">key</span><span class="p">.</span><span class="na">equals</span><span class="p">(</span><span class="n">k</span><span class="p">))))</span>
                    <span class="k">break</span><span class="p">;</span>
                <span class="n">p</span> <span class="o">=</span> <span class="n">e</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">e</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// existing mapping for key
</span><span class="c1"></span>            <span class="n">V</span> <span class="nf">oldValue</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">value</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">onlyIfAbsent</span> <span class="o">||</span> <span class="n">oldValue</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
                <span class="n">e</span><span class="p">.</span><span class="na">value</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
            <span class="n">afterNodeAccess</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
            <span class="k">return</span> <span class="n">oldValue</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="o">++</span><span class="n">modCount</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">++</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">)</span>
        <span class="n">resize</span><span class="p">();</span>
    <span class="n">afterNodeInsertion</span><span class="p">(</span><span class="n">evict</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>
<span class="o">&lt;!----&gt;</span>
<span class="kd">final</span> <span class="nf">void</span> <span class="n">treeifyBin</span><span class="p">(</span><span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span><span class="p">[]</span> <span class="nf">tab</span><span class="p">,</span> <span class="kt">int</span> <span class="nf">hash</span><span class="p">)</span> <span class="p">{</span>
    <span class="kt">int</span> <span class="nf">n</span><span class="p">,</span> <span class="n">index</span><span class="p">;</span> <span class="n">Node</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">e</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">tab</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">||</span> <span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="n">tab</span><span class="p">.</span><span class="na">length</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">MIN_TREEIFY_CAPACITY</span><span class="p">)</span>
        <span class="n">resize</span><span class="p">();</span>
    <span class="k">else</span> <span class="k">if</span> <span class="p">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">tab</span><span class="p">[</span><span class="n">index</span> <span class="o">=</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="n">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">hash</span><span class="p">])</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">hd</span> <span class="o">=</span> <span class="kc">null</span><span class="p">,</span> <span class="n">tl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">do</span> <span class="p">{</span>
            <span class="n">TreeNode</span><span class="o">&lt;</span><span class="n">K</span><span class="p">,</span><span class="n">V</span><span class="o">&gt;</span> <span class="nf">p</span> <span class="o">=</span> <span class="n">replacementTreeNode</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">tl</span> <span class="o">==</span> <span class="kc">null</span><span class="p">)</span>
                <span class="n">hd</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="n">p</span><span class="p">.</span><span class="na">prev</span> <span class="o">=</span> <span class="n">tl</span><span class="p">;</span>
                <span class="n">tl</span><span class="p">.</span><span class="na">next</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="n">tl</span> <span class="o">=</span> <span class="n">p</span><span class="p">;</span>
        <span class="p">}</span> <span class="k">while</span> <span class="p">((</span><span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="na">next</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">tab</span><span class="p">[</span><span class="n">index</span><span class="p">]</span> <span class="o">=</span> <span class="n">hd</span><span class="p">)</span> <span class="o">!=</span> <span class="kc">null</span><span class="p">)</span>
            <span class="n">hd</span><span class="p">.</span><span class="na">treeify</span><span class="p">(</span><span class="n">tab</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></div>
<p>同样，get(key)的时候也会相应的从树中查找元素。</p>


        
          <div class="blog-tags">
            
              <a href="https://atbug.com//tags/java/">Java</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="https://atbug.com/singleton-in-multi-threads-programming/" data-toggle="tooltip" data-placement="top" title="多线程下的单例模式&#43;反汇编">&larr; 前一篇</a>
            </li>
          
          
            <li class="next">
              <a href="https://atbug.com/crlf-in-git/" data-toggle="tooltip" data-placement="top" title="Git回车换行">后一篇 &rarr;</a>
            </li>
          
        </ul>
      


      

    </div>
  </div>
</div>

      
<footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              Addo Zhang
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2015 - 2019
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://atbug.com/">乱世浮生</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          由 <a href="https://gohugo.io">Hugo v0.57.2</a> 强力驱动 &nbsp;&bull;&nbsp; 主题 <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> 移植自 <a href="https://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a>
          
        </p>
      </div>
    </div>
  </div>
</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="https://atbug.com/js/main.js"></script><script> renderMathInElement(document.body); </script><script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script><script src="https://atbug.com/js/load-photoswipe.js"></script>









    
  </body>
</html>

